\chapter{Теоретико-игровая модель биржевых торгов с непрерывными ставками} \label{chapt3}%
{
\newcommand{\Port}[1]{\ensuremath{\pi_{#1}}}
\newcommandx*\Ff[3][1={(f, Q)}, 2=n+1]{\ensuremath{F_{#2} \left(p, {#1}, {#3} \right)}}
\newcommand*\dualFPS{\ensuremath{(p,\ \sigma)}}
\newcommandx*\dualg[4][1=n, 2={\dualFPS}, 3=z, 4=\tau]{\ensuremath{g^*_{#1}({#3}, {#2}, {#4})}}
\newcommandx*\Gf[2][1=x, 2=\tau_1]{\ensuremath{G_{n+1} \left(z, {#1}, {#2} \right)}}

\DeclareDocumentCommand{\LV}{O{} m}{\ensuremath{\underline{V}^{#1}_{#2}}}
\DeclareDocumentCommand{\HV}{O{} m}{\ensuremath{\overbar{V}^{#1}_{#2}}}
\DeclareDocumentCommand{\HW}{O{} m}{\ensuremath{\overbar{W}^{#1}_{#2}}}
\DeclareDocumentCommand{\LW}{O{} m}{\ensuremath{\underline{W}^{#1}_{#2}}}

В разделах~\ref{ch3:sec:model-descr} и~\ref{ch3:sec:formal-descr} приводится описание модели биржевых торгов с вещественными ставками и теоретико-игровая постановка основной задачи и двойственной к ней в смысле Де~Мейера.
В разделе~\ref{ch3:sec:1st} получено решение одношаговой игры, на примере которой демонстрируются идеи, использованные при решении $n$-шаговой игры.
В разделе~\ref{ch3:sec:value-bounds} построены выравнивающие стратегии первого и второго игроков и получены оценки выигрыша в прямой и двойственной играх.
В разделе~\ref{ch3:sec:game-value} даны теоремы о значении игры, приведены асимптотические свойства последовательности апостериорных вероятностей при стремлении числа шагов к бесконечности, а также дан алгоритм построения оптимальных стратегий игроков.
Примеры аналитического построения оптимальных стратегий в одношаговой и двухшаговой играх даны в разделе~\ref{ch3:sec:examples}.

Основные результаты данной главы опубликованы в работе \cite{pyanykh16:cont} в журнале из перечня ВАК.

\section{Описание модели}
\label{ch3:sec:model-descr}

Рассматриваемая в текущей главе модель биржевых торгов аналогична модели из главы~\ref{chapt1} за исключением того, что теперь игроки могут делать произвольные вещественные ставки из отрезка $[0, 1]$.
В отличие от дискретной модели, для подобных повторяющихся игр с конечным числом шагов нет общей теории, из которой вытекало бы существование значения.
При анализе повторяющейся игры с вещественными ставками мы следуем схеме из~\cite{demeyer02c}.

Как и в главе~\ref{chapt1} множество возможных состояний рынка $S = \{H, L\}$, $s \in S$ при этом обозначает состояние, в котором на самом деле находится рынок.
На каждом шаге торгов, первый игрок делает ставку из множества $I = [0, 1]$, второй игрок "--- ставку из множества $J = [0,1]$.

Обозначим через $\Port{t} = (\Port{t}^R, \Port{t}^N)$ портфель первого игрока на $t$-м шаге торгов, где $\Port{t}^R$ и $\Port{t}^N$ "--- количество единиц рискового и безрискового активов соответственно.
Если на $t$-м шаге игроки делают ставки $x \in I,\ y \in J$, то портфель 
\[
\Port{t} = \Port{t-1} + \vartheta(x, y),
\]
где
\begin{equation}\label{ch3:eq:trans-mech}
  \vartheta(x, y) = \Ind{x > y} (1, -(\Co x + \DCo y)) +
  \Ind{x < y} (-1, \DCo x + \Co y).
\end{equation}
Таким образом, одна акция продается по цене, равной выпуклой комбинации предложенных ставок с заданным коэффициентом $\Co$.
Стоимость портфеля при этом равна
\begin{equation*}
  V(\Port{t}) \eqdef \Ind{s = H} \, \Port{t}^R + \Port{t}^N.
\end{equation*}
Цель игроков состоит в максимизации прибыли, полученной от торгов.

Как и в главе \ref{chapt1}, можно положить, что в начальный момент времени оба игрока имеют нулевые портфели.
При этом прибыль первого игрока после завершения сделок будет равна $V(\Port{n})$, а второго $-V(\Port{n})$.

\section{Постановка задачи}
\label{ch3:sec:formal-descr}

Ниже мы рассмотрим теоретико-игровую постановку основной задачи и двойственной к ней в смысле Де~Мейера, которые мы будем называть прямой и двойственной играми соответственно.
Как отмечено в \cite{demeyer02}, прямая (двойственная) игра больше подходит для построения оптимальной стратегии первого (второго) игрока.

\subsection{Определение прямой игры $\mathbf{ G_{n}(p) }$}
Прямая игра описывает взаимодействие между агентами, соответствующее оригинальной модели биржевых торгов.
Так же перед началом игры ходом случая определяется $s \in S$ таким образом, что $P(s = H) = p, \; P(s = L) = 1-p$.
Выбранное $s$ сообщается первому игроку (инсайдеру), второй игрок при этом не осведомлен о настоящем значении $s$ и знает только вероятности выбора случаем того или иного состояния.

Стратегией первого игрока является последовательность ходов (отображений) $\sigma = (\sigma_1, \ldots, \sigma_n)$, где $\sigma_t = (\sigma^L_t,\ \sigma^H_t)$.
При фиксированном $s \in S$ ход $\sigma^s_t: H_{t-1} \rightarrow \Delta(I)$ является отображением из множества историй ставок $H_{t-1} = I^{t-1} \times J^{t-1}$ к моменту времени $t$ в множество $\Delta(I)$ вероятностных распределений на $I$.
Обозначим множество стратегий первого игрока $\Sigma_n$.
Аналогично, стратегией второго игрока назовем последовательность ходов (отображений) $\tau = (\tau_1, \ldots, \tau_n)$, где $\tau_t: H_{t-1} \rightarrow \Delta(J)$.
Обозначим множество стратегий второго игрока $\Tau_n$.

Пара стратегий $(\sigma, \tau)$ вместе с ходом случая индуцирует на $S \times H_n$ вероятностное распределение $\Pi[p, \sigma, \tau]$.
Тогда выигрыш первого игрока равен
\[
  g^\Co_n(p, \sigma, \tau) = \E_{( p, \sigma, \tau )} V(\Port{n}).
\]
Выигрыш второго игрока при этом равен $-g^\Co_n(p, \sigma, \tau)$.

Полученную игру обозначим через $G^\Co_n(p)$. 
Ее нижнее и верхнее значения даются формулами
\begin{align*}
  \LV[\Co]{n}(p) = \sup_\sigma \inf_\tau g^\Co_n(p, \sigma, \tau), \quad
  \HV[\Co]{n}(p) = \inf_\tau \sup_\sigma g^\Co_n(p, \sigma, \tau).
\end{align*}
В том случае, когда $\LV[\Co]{n}(p) = \HV[\Co]{n}(p) = V^\Co_n(p)$, будем говорить, что игра имеет значение $V_n(p)$.
При этом стратегии $\sigma^0$ и $\tau^0$ называются оптимальными, если
\[
  \inf_\tau g^\Co_n(p, \sigma^0, \tau) = \LV[\Co]{n}(p), \enskip 
  \sup_\sigma g^\Co_n(p, \sigma, \tau^0) = \HV[\Co]{n}(p).
\]
В дальнейшем верхний индекс $\Co$ мы будем часто опускать.

В работе \cite{demeyer02} показано, что игра $G_n(p)$ имеет рекурсивную структуру аналогичную структуре повторяющейся игры из главы~\ref{chapt1}.
Соответственно, рассмотрим стратегию $\sigma$ первого игрока как пару $(\sigma_1, \tilde{\sigma})$, где $\sigma_1$ -- ход игрока на первом шаге игры, а $\tilde{\sigma}$ -- стратегия в игре продолжительности $n$, зависящая от ставок $(x, y)$ на первом шаге.
Аналогично стратегию $\tau$ второго игрока можно представить как пару $(\tau_1, \tilde{\tau})$.
Случайные величины ставок, имеющих распределения $\sigma_1$ и $\tau_1$, обозначим через $X$ и $Y$ соответственно.

Приведем несколько известных фактов, которые понадобятся нам в дальнейшем.

Пара $(\sigma_1, \tau_1)$ вместе с ходом случая индуцирует вероятностное распределение $\Pi[p, \sigma_1, \tau_1]$ на $S \times I \times J$.
Обозначим через
\[
  p(x) = \Pi[p, \sigma_1](s = H\ |\ X = x)
\]
апостериорную вероятность состояния $H$ при условии, что первый игрок сделал ставку $x$.
Отметим, что апостериорная вероятность не зависит от ставки второго игрока $y$, так как она не зависит от $s$.
Тогда для значения выигрыша первого игрока справедливо представление
\begin{align*}
  g_{n+1}(p, \sigma, \tau) 
  &= 
    g_1(p, \sigma_1, \tau_1) +
    \E_{( p, \sigma_1, \tau_1 )}
    g_n(p(X), \tilde{\sigma}(X, Y), \tilde{\tau}(X, Y)).
\end{align*}
Отсюда вытекает справедливость следующего утверждения для нижнего значения игры (\seename~\cite{demeyer02}).
\begin{lemma}
  \label{ch3:lem:low-bound-primal}
  Для любого $p \in [0, 1]$ выполняется неравенство
  \begin{equation}
    \LV{n+1}(p) \geqslant \sup_{\sigma_1} \inf_{y} \left[
      g_1(p, \sigma_1, y)
    + \E_{( p, \sigma_1 )} \LV{n}\left( p(X) \right)
    \right]
  \end{equation}
\end{lemma}
Подчеркнем, что поскольку можно положить $V_0(p) \equiv 0$, неравенство \eqref{ch3:lem:low-bound-primal} имеет смысл для любого целого $n \geqslant 1$.

В силу того, что игра с $p \in \{0, 1\}$ имеет тривиальное решение, дальнейшие построения будут проведены для значений $p \in (0, 1)$.

\subsection{Определение двойственной игры $\mathbf{ G^{*}_{n}(z) }$}
Определим двойственную игру $G^*_n(z)$, следуя работе~\cite{demeyer02}.
Перед началом игры первый игрок выбирает текущее состояние $s \in S$; второй игрок не осведомлен о выборе первого.
Если $s = H$, то первый вынужден заплатить второму штраф $z$ в конце игры.
В остальном правила двойственной игры $G^*_n(z)$ аналогичны правилам игры $G_n(p)$.

Стратегией первого игрока в двойственной игре является пара $\dualFPS$, где $p \in [0, 1]$, $\sigma \in \Sigma_n$.
Множество стратегий второго игрока совпадает с $\Tau_n$.

Выигрыш второго игрока, который он стремится максимизировать, определяется как
\begin{equation*}
  \dualg = z p - g_n(p, \sigma, \tau),
\end{equation*}
а верхнее и нижнее значения игры даются, соответственно, формулами
\begin{equation*}
  \HW{n}(z) = \inf_{\dualFPS} \sup_\tau \dualg, \enskip
  \LW{n}(z) = \sup_\tau \inf_{\dualFPS} \dualg.
\end{equation*}
В том случае, когда $\HW{n}(z) = \LW{n}(z) = W_n(z)$, будем говорить, что игра имеет значение $W_n(z)$.

Обозначим выигрыши в состояниях $H$ и $L$ через
\begin{equation*}
 g^H_1(\sigma_1, \tau_1) = g_1(1, \sigma_1, \tau_1), \enskip g^L_1(\sigma_1, \tau_1) = g_1(0, \sigma_1, \tau_1).
\end{equation*}
Аналогично предыдущему пункту, можно провести рассмотрение рекурсивной структуры игры $G^*_n(z)$ и получить следующий результат из \cite{demeyer02}.
\begin{lemma}\label{ch3:lem:low-bound-dual:general}
  Для любого $z \in \mathbb{R}$ выполняется неравенство
  \begin{equation}\label{ch3:eq:low-bound-dual:general}
    \LW{n+1}(z) \geqslant \sup_{\tau_1} \inf_x
    \LW{n}(z - g^H_1(x, \tau_1) + g_1^L(x, \tau_1)) - g^L_1(x, \tau_1).
  \end{equation}
\end{lemma}
Отметим, что так как $W_0(z) = \phi(z) = \min(z, 0)$, формула имеет смысл для любого $n \geqslant 1$.

\section{Решение одношаговой игры}
\label{ch3:sec:1st}

Получим решение одношаговой игры $G^\Co_1(p)$.
Для игры, соответствующей значению параметра $\Co = 1$, решение было получено в~\cite{sandomirskaya12}.
В силу того, что в состоянии $L$ при $\Co = 1$ стратегия, предписывающая использование ставки $0$ с вероятностью $1$, является доминирующей, исходную игру удалось представить в виде игры с выбором момента времени, для которой известен метод решения (\seename~\cite{karlin64}).
При $\Co \neq 1$ указанная чистая стратегия уже не является доминирующей, однако, как будет показано далее, при $p < \Co$ все равно является оптимальной для первого игрока.

Начнем рассмотрение со случая $p < \beta$.
Будем искать оптимальные стратегии игроков, удовлетворяющие следующим условиям.
Первый игрок в состоянии $L$ использует ставку $0$ с вероятностью 1.
Обозначим такое распределение через $I_0$.
В состоянии $H$ он рандомизирует действия, используя при некотором $d \in (0, 1]$ функцию распределения $F(x)$ со спектром $[0, d]$ и плотностью $f(x)$ на этом отрезке. При этом $F(0) = 0, F(d) = 1$.

Второй игрок рандомизирует действия используя функцию распределения $G(y)$, имеющую скачок величины $\delta$ в точке $0$ и плотность $g(x)$ на $(0, d]$.
Обозначим такое распределение через $(\delta I_o, g)$.
Описанные стратегии имеют одинаковый спектр $[0, d]$.

Смешанная стратегия $\sigma^0$ первого игрока называется выравнивающей на множестве $J^0 \subset J$, если $g_1(p, \sigma^0, y) \equiv const,\ y \in J^0$ (\seename~\cite{morozov05}).
Аналогично определяется выравнивающая стратегия второго игрока.

Поскольку оптимальная стратегия первого игрока является выравнивающей при $y \in (0, d)$, $d \in (0, 1]$ и
\begin{equation}
  \label{ch3:eq:1st:g1(F,0)}
  \begin{gathered}
    g_1(p, (F, I_0), y) 
    = p g^H_1(p, F, y) + (1-p) g^L_1(p, I_0, y) = \\
    = p \left( 
      \int_0^y (\DCo x + \Co y - 1) f(x) \di x +
      \int_y^d (1 - \Co x - \DCo y) f(x) \di x
    \right) + (1-p) \Co y,
  \end{gathered}
\end{equation}
имеем
\begin{align*}
  \frac{\partial g_1(p, (F, I_0), y)}{\partial y}
  &= p \left( 
    \int_0^y f(x) \di x - \DCo + 2(y-1)f(y)
  \right) +
  (1-p)\Co =\\
  &= p F(y) + 2p(y-1)F'(y) + \Co - p = 0.
\end{align*}
Общее решение данного уравнения представимо в виде
\begin{equation*}
  F(x) = \frac{C}{\sqrt{2(1-x)}} - \frac{\Co - p}{p},\ x \in [0, d].
\end{equation*}
Из условий $F(0) = 0,\ F(d) = 1$ находим $C = \sqrt{2}(\Co - p)/p,\ d = 1 - (\Co - p)^2/\Co^2$, откуда получаем
\begin{equation}
  \label{ch3:eq:1st:F}
  \begin{gathered}
    F^0(x) =
    \begin{cases}
      \frac{\Co - p}{p}(\frac{1}{\sqrt{1-x}} - 1),\ & 0 \leq x \leq 1 - d,\\
      1,\ & \text{иначе},
    \end{cases}\\
    f^0(x) =
    \begin{cases}
      \frac{\Co - p}{2 p} \frac{1}{(1-x)^{3/2}},\ & 0 \leq x \leq 1 - d,\\
      0,\ & \text{иначе}.
    \end{cases}
  \end{gathered}
\end{equation}
\begin{lemma}
  \label{ch3:lem:1st:lower-bound}
  При заданных $p$ и $\Co$ таких, что $p < \Co$, стратегия первого игрока $(\sigma^H, \sigma^L) = (F^0, I_0)$, где $F^0$ определяется в \eqref{ch3:eq:1st:F}, гарантирует ему выигрыш не менее $p(1-p)$ в игре $G^\Co_1(p)$.
\end{lemma}
\begin{proof}
  При $y \in (0, d)$ получим ожидаемый выигрыш первого игрока, подставив \eqref{ch3:eq:1st:F} в \eqref{ch3:eq:1st:g1(F,0)}.
  Для $g^H_1(p, (F^0, I_0), y)$ имеем
  \begin{equation*}
    \begin{gathered}
    g^H_1(p, (F^0, I_0), y) 
    =
    \int_0^y (\DCo x + \Co y - 1) f^0(x) \di x +
    \int_y^d (1 - \Co x - \DCo y) f^0(x) \di x = \\
    =
    - \int_0^d \Co x f^0(x) \di x +
    \int_0^d \Co y f^0(x) \di x -
    \int_0^y (1-x) f^0(x) \di x + \\
    + \int_y^d (1-y) f^0(x) \di x
    \end{gathered}
  \end{equation*}
  Находим
  \begin{equation}
    \label{ch3:eq:1st:f-exp}
    \begin{aligned}
      \int_0^d x f^0(x) \di x 
      &= \frac{\Co - p}{2 p} \int_0^d x \frac{1}{(1-x)^{3/2}} \di x = \\
      &= \frac{\Co - p}{2 p} \left( 
        2x \frac{1}{\sqrt{1-x}} \bigg|_0^d +
        4 \sqrt{1-x} \bigg|_0^d
      \right) = \\
      &= \frac{\Co - p}{p} \cdot \frac{2 - d - 2\sqrt{1-d}}{\sqrt{1-d}} =
      \frac{\Co - p}{p} \cdot \frac{p^2}{(\Co - p) \Co} = \frac{p}{\Co}.
    \end{aligned}
  \end{equation}
  Отсюда имеем
  \begin{gather*}
    g^H_1(p, (F^0, I_0), y) 
    = -p + \Co y +
    \frac{\Co - p}{p} \left( \sqrt{1-y} - 1 \right) +
    (1-y) \times \\
    \times \left( 1 - \frac{\Co - p}{p} \left( \frac{1}{\sqrt{1-y}} - 1 \right) \right) =
    -p + \Co y - \frac{\Co - p}{p} + (1-y) \left( 1 + \frac{\Co - p}{p} \right) = \\
    = \frac{(1-p)(p - \Co y)}{p}.
  \end{gather*}
  Подставив данное выражение в \eqref{ch3:eq:1st:g1(F,0)}, находим $g_1(p, (F^0, I_0), y) = p (1-p)$.

  При $y \in \{0, d\}$ выигрыш равен
  \begin{align*}
    g_1(p, (F^0, I_0), 0) 
    &= p \left(\int_0^d f^0(x) \di x - \Co \int_0^d x f^0(x) \di x \right) =
      p(1-p),\\
    g_1(p, (F^0, I_0), d) 
    &=
      p \int_0^d (\DCo x + \Co d - 1) f^0(x) \di x + (1-p) \Co d = \\
    &= p \frac{(1-p)(p-\Co)}{\Co} +
      (1-p) \Co \left( 1 - \frac{(\Co - p)^2}{\Co^2} \right) = p(1-p).
  \end{align*}

  При $y > d$ справедливо
  \begin{align}
    g_1(p, (F^0, I_o), y)
    &= p \int_0^d (\DCo x + \Co y - 1) f^0(x) \di x + (1-p) \Co y > \\
    &> p \int_0^d (\DCo x + \Co d - 1) f^0(x) \di x + (1-p) \Co d = \\
    &= g_1(p, (F^0, I_o), d).\\
  \end{align}

  Таким образом, $\LV{1}(p) \geq p(1-p)$.
\end{proof}

Стратегию второго игрока будем искать из условия выравнивания выигрыша первого при применении им действия $(x^H, 0),\ x^H \in (0, d)$.
Выигрыш дается формулой
\begin{align*}
  g_1(p, (x^H, 0), G) 
  &= p \left(
    \int_0^{x^H} (1 - \Co x^H  - \DCo y) G(\di y) + \int_{x^H}^d (\DCo x + \Co y - 1) G(\di y)
    \right) + \\
  &+ (1-p) \int_0^d \Co y g(y) \di y.
\end{align*}
Отсюда получаем
\begin{align*}
  \frac{\partial g_1(p, (x^H, 0), G)}{\partial x^H} 
  &= -\int_0^x G(\di y) + 2(1-x) g(x) + \DCo \int_0^d G(\di y) = \\
  &= -G(x) + 2(1-x)G'(x) + \DCo =
  0.
\end{align*}
Общее решение данного дифференциального уравнения имеет вид 
\begin{equation*}
  G(y) = \frac{C}{\sqrt{2}\sqrt{1-x}} + \DCo.
\end{equation*}
Из условия $G(d) = 1$ находим $C = \sqrt{2}(\Co - p)$, откуда вытекает
\begin{equation}
  \label{ch3:eq:1st:G}
  \begin{gathered}
    G^0(y) =
    \begin{cases}
      \frac{\Co - p}{\sqrt{1-y}} + \DCo,\ & 0 \leq y \leq 1 - \frac{(\Co - p)^2}{\Co^2},\\
      1,\ & \text{иначе},
    \end{cases}\\
    g^0(y) =
    \begin{cases}
      \frac{\Co - p}{2(1-y)^{3/2}},\ & 0 \leq y \leq 1 - \frac{(\Co - p)^2}{\Co^2},\\
      0,\ & \text{иначе},
    \end{cases}
  \end{gathered}
\end{equation}
Величина скачка в точке $0$ равна $\delta = G^0(0) = 1 - p$.

\begin{lemma}
  \label{ch3:lem:1st:upper-bound}
  При заданных $p$ и $\Co$ таких, что $p < \Co$, стратегия второго игрока $G^0$, где $G^0$ определяется в \eqref{ch3:eq:1st:G}, гарантирует ему проигрыш не более $p(1-p)$ в игре $G^\Co_1(p)$.
\end{lemma}
\begin{proof}
  Поскольку $g^0 = p f^0$, интеграл $\int_0^d y g^0(y) \di y = p^2/\Co$.
  Покажем, что $g^L_1(p, x^L, G^0) < g^L_1(p, 0, G^0),\ x^L \in (0, 1]$.
  В случае $x^L \in (0, d]$ получаем
  \begin{align*}
    g^L_1(p, x^L, G^0)
    &= \int_0^{x^L} (-\Co x^L - \DCo y) G^0(\di y) + \int_{x^L}^d(\DCo x^L + \Co y) G^0(\di y) = \\
    &= - \Co x^L - \int_0^{x^L} y g^0(y) \di y + \int_{x^L}^d x^L g^0(y) \di y + \Co \int_0^d y g^0(y) \di y = \\
    &= - \frac{\Co x^L}{p} \int_0^d g^0(y) \di y - \int_0^{x^L} y g^0(y) \di y + \int_{x^L}^d x^L g^0(y) \di y + g^L_1(p, 0, G^0) < \\
    &< -\int_0^d x^L g^0(y) \di y + \int_{x^L}^d x^L g^0(y) \di y - \int_0^{x^L} y g^0(y) \di y + g^L_1(p, 0, G^0) = \\
    &= - \int_0^{x^L} (x^L + y) g^0(y) \di y + g^L_1(p, 0, G^0) < g^L_1(p, 0, G^0).
  \end{align*}
  При $x^L \in (d, 1]$ соответствующее неравенство доказывается аналогично.
  Таким образом, использование первым игроков стратегии $I_0$ в состоянии $L$ является наилучшим ответом на стратегию $G^0$ второго игрока.
  Максимальный проигрыш в состоянии $L$ второго игрока равен $g^L_1(p, 0, G^0) = p^2$.
  
  Найдем выигрыш первого игрока в состоянии $H$, подставив (\ref{ch3:eq:1st:G}) в (\ref{ch3:eq:1st:g1(F,0)}).
  При $x^H \in (0, d)$ имеем
  \begin{align*}
    g^H_1(p, x^H, G^0)
    &= (1 - p)(1 - x\Co)
      + \int_0^x (1 - \Co x - \DCo y) g^0(y) \di y\ + \\
    &+ \int_x^d (\DCo x + \Co y - 1) g^0(y) \di y = \\
    &= (1 - p)(1 - x\Co)
      + \int_0^x (1-y) g^0(y) \di y - \int_x^d (1-x) g^0(y) \di y\ + \\
    &+ \Co \int_0^d y g^0(y) \di y - \Co \int_0^d x g^0(y) \di y = \\
    &= (1 - p)(1 - x\Co)
      + (\Co - p)\left(-\sqrt{1-y}\bigg|_0^x\right) - \\
    &- (1 - x)(G^0(d) - G^0(x))
      + p(p - x\Co) = \\
    &= (1 - p)(1 - x\Co)
      + (\Co - p)(1 - \sqrt{1-x}) + \\
    &+ (\Co - p)\sqrt{1-x} - \Co (1 - x) + p(p - x\Co) = \\
    &= (1 - p)(1 - x\Co) + (1 - p)(x\Co - p) = (1 - p)^2.
  \end{align*}
  Также несложно показать, что 
  \begin{gather*}
    g^H_1(p, 0, G^0) = 0,\enskip
    g^H_1(p, d, G^0) = (1 - p)^2, \\
    g^H_1(p, x^H, G^0) < g^H_1(p, d, G^0),\ x \in (d, 1].
  \end{gather*}
  Отсюда получаем, что $\HV{1}(p) \leq p(1-p)$.
\end{proof}

Из лемм \ref{ch3:lem:1st:lower-bound} и \ref{ch3:lem:1st:upper-bound} следует, что при $p < \Co$ оптимальные стратегии определяются формулами (\ref{ch3:eq:1st:F},~\ref{ch3:eq:1st:G}), а значение игры равно $V_1(p) = p(1-p)$.

Так как для произвольных $x^H, x^L, y$ из отрезка $[0, 1]$ справедливо равенство
\[
  g^\Co_1(p, (x^H, x^L), y) = g^{1-\Co}_1(1 - p, (1 - x^L, 1 - x^H), 1 - y),
\]
то решение одношаговой игры с параметрами $(p, \Co)$ сводится к решению одношаговой игры с параметрами $(1 - p, 1 - \Co)$.

Кроме того, несложно показать, что при $p = \Co$ стратегия первого игрока $(\sigma^H,\ \sigma^L) = (I_1,\ I_0)$ и стратегия второго игрока $\tau = \left( (1-p) I_0,\ p I_1 \right)$ являются оптимальными, а значение игры также равно $p(1-p)$.

Таким образом, уже на примере одношаговой игры можно наблюдать тот эффект, что значение игры не зависит от параметра $\Co$.

\section{Оценки выигрыша в $\mathbf{ n }$-шаговой игре}
\label{ch3:sec:value-bounds}

В данном разделе будут построены выравнивающие стратегии первого и второго игроков в прямой и двойственной играх, соответственно.
Будет показано, что несмотря на то, что по виду данные стратегии отличается от стратегий из \cite{demeyer02}, вид оценок для нижних значений $\LV{n}(p)$ и $\LW{n}(z)$ прямой и двойственной игр остается неизменным.
Отсюда будет следовать справедливость двойственных соотношений между $\LV{n}(p)$ и $\LW{n}(z)$, существование значений прямой игры $V_n(p)$ и двойственной игры $W_n(z)$, формулы для их расчета, а также оптимальность построенных стратегий.

Нам потребуются некоторые определения и факты из выпуклого анализа.
%
Пусть $a(v)$ "--- вогнутая функция, определенная на прямой, причем $a$ может принимать значение $-\infty$.
Функцией, сопряженной к $a$ в смысле Фенхеля, называется
\begin{equation*}
  a^*(u) = \inf_{v \in \R} \left( u v - a(v) \right).
\end{equation*}
Эффективное множество функции $a$ определяется следующим образом:
\[
\dom a = \{ v \;|\; a(v) > -\infty \}.
\]
Множество значений функции $a$ будем обозначать \[
\range a = \{ a(v) \;|\; v \in \mathbb{R} \}.
\]
%
Субдифференциалом функции $a$ в точке $v$ называется множество
\begin{equation*}
  \partial a(v) =
  \{ c \in \mathbb{R} \;|\; \forall y \in \mathbb{R}: a(y) \leqslant a(v) + c(y-v) \}.
\end{equation*}

Справедливо утверждение \cite[Теорема 23.5]{rockafellar73}:
\begin{equation}\label{ch3:eq:subdiff-props}
  u \in \partial a(v)
  \iff v = \arg\!\min_w \left( w u - a(w) \right)
  \iff v \in \partial a^*(u) .
\end{equation}
Кроме того, имеют место следующие включения \cite[\S~24]{rockafellar73}:
\begin{equation}\label{ch3:eq:dual-range}
  \mathrm{int} \; (\dom a) \subset \range \partial a^* \subset \dom a.
\end{equation}

В \cite{demeyer02} показано, что функции $\LV{n}(x)$ и $\LW{n}(z)$ являются вогнутыми на своей области определения.
Предположим дополнительно, что $\LV{n}(x)$, $\LV[*]{n}(z)$ и $\LW{n}(z)$ непрерывно дифференцируемы.
Справедливость данных предположений будет обоснована в разделе~\ref{ch3:sec:game-value}.


\subsection{Оценка нижнего значения игры $\mathbf{ G_{n}(p) }$}
\label{ch3:sec:-primal-game}

Обозначим через $\sigma^M_1 = p \sigma^H_1 + (1-p) \sigma^L_1$ маргинальное распределение ставки $X$ при использовании одношаговой стратегии $\sigma_1 = (\sigma^H_1, \sigma^L_1)$, а соответствующую функцию распределения обозначим $F_{\sigma^M_1}(x)$.

Возьмем случайную величину $U$, равномерно распределенную на $[0, 1]$, и положим
\begin{equation*}
  f(u) = F^{-1}_{\sigma^M_1}(u)
  \eqdef \min \{ v\ |\ F_{\sigma^M_1}(v) \geq u \},\ u \in [0, 1].
\end{equation*}
Известно, что тогда случайные величины $f(U)$ и $X$ одинаково распределены.

Далее, обозначим $Q(u) = p(f(u))$.
Легко видеть, что для условной апостериорной вероятности $p(x)$ состояния $H$ (при условии, что выбрана ставка $x$) справедливо
\begin{equation*}
  \int_I p(x) \sigma^M_1(\di x) = \Pi[p, \sigma_1](s = H, X \in I) = p.
\end{equation*}
Так как случайные величины $f(U)$ и $X$ одинаково распределены, то имеет место равенство
\begin{equation*}
  \int_0^1 Q(u) \di u = p.
\end{equation*}
Таким образом, функции $Q(u)/p$ и $(1-Q(u))/(1-p)$ являются условными плотностями при реализации состояний $H$ и $L$ соответственно.

В \cite{demeyer02} рассматривается параметризация одношаговой стратегии инсайдера функциями $f$ и $Q$, которые используются для генерации маргинального распределения ставки $x$ и апостериорной вероятности $p(x)$ соответственно.
Далее мы покажем, что задание стратегии первого игрока при помощи пары $(f, Q)$ в некотором смысле естественно и приведем способ перехода от параметризованного представления к стратегии $\sigma_1$.

\begin{proposition}
  Для апостериорной вероятности $p(x)$ состояния $H$ справедлива формула
  \begin{equation}\label{ch3:eq:p(x)}
    p(x) = p \; \frac{\di \sigma^H_1}{\di \sigma^M_1}(x),
  \end{equation}
  где $\di \sigma^H_1/\di \sigma^M_1$ -- производная Радона-Никодима.
\end{proposition}
\begin{proof}
  По определению $p(x)$ для любого множества $B$ из борелевской $\sigma$-алгебры $\Borel(I)$ отрезка $I$ выполнено
  \begin{equation*}
    P(s = H, \; X \in B) = \int_B p(x) \; \sigma^M_1(\di x).
  \end{equation*}
  С другой стороны, справедлива следующая формула:
  \begin{equation*}
    P(s = H, \; X \in B) = p \int_B \sigma^H_1(\di x).
  \end{equation*}

  Нетрудно видеть, что для любого множества $B \in \Borel(I)$ справедливо $\sigma^M_1(B) = 0 \implies \sigma^H_1(B) = 0$, то есть $\sigma^H_1$ абсолютно непрерывна относительно $\sigma^M_1$.
  Следовательно существует производная Радона-Никодима (\seename~\cite{kolmogorov-fomin}), а значит
  \begin{equation*}
    P(s = H, \; X \in B) =
    \int_B p \frac{\di \sigma^H_1}{\di \sigma^M_1}(x) \; \sigma^M_1(\di x).
  \end{equation*}
  Отсюда получаем \eqref{ch3:eq:p(x)}.
\end{proof}

\begin{proposition}
  Для $g_1(p, \sigma_1, y)$ справедливо представление
  \begin{equation}\label{ch3:eq:g1-aposterior}
    \begin{multlined}
      g_1(p, \sigma_1, y) = \int_I \Ind{x > y} \biggl[ p(x) - \Co x - \DCo y \biggr] \; \sigma^M_1(\di x) \; + \\
      + \int_I \Ind{x < y} \biggl[ \DCo x + \Co y - p(x) \biggr] \;
      \sigma^M_1(\di x).
    \end{multlined}
  \end{equation}
\end{proposition}
\begin{proof}
  По определению
  \begin{equation}\label{ch3:eq:g1-def}
    g_1(p, \sigma_1, y) = \E_{( p, \sigma_1 )} \langle
    (\Ind{s = H}, 1), \vartheta(x, Y)
    \rangle,
  \end{equation}
  где функция $\vartheta(x, y)$ определена в~(\ref{ch3:eq:trans-mech}).
  Подставив~\eqref{ch3:eq:trans-mech} в~\eqref{ch3:eq:g1-def}, получим
  \begin{align*}
    g_1(p, \sigma_1, y) 
    &= p \int_I \biggl[ \Ind{x > y}(1 - \Co x - \DCo y) + \Ind{x < y} (\DCo x + \Co y - 1) \biggr] \; \sigma^H_1(\di x) + \\
    &+ (1-p) \int_I \biggl[
      \Ind{x > y} (- \Co x - \DCo y) + \Ind{x < y}(\DCo x + \Co y) 
    \biggr]
    \; \sigma^L_1(\di x) = \\
    &= \int_I \Ind{x > y} p \sigma^H_1(\di x) -
    \int_I \Ind{x > y} (\Co x + \DCo y) \sigma^M_1 (\di x) + \\
    &+ \int_I \Ind{x < y} (\DCo x + \Co y) \sigma^M_1 (\di x) -
    \int_I \Ind{x < y} p \sigma^H_1(\di x).
  \end{align*}
  Отсюда, воспользовавшись~\eqref{ch3:eq:p(x)}, получим~\eqref{ch3:eq:g1-aposterior}.
\end{proof}

Формула \eqref{ch3:eq:g1-aposterior} показывает альтернативное представление стратегии инсайдера $\sigma_1$ с помощью маргинального распределения ставки и апостериорной вероятности состояния $H$.

Укажем способ перехода от $\sigma_1$ к параметризованному представлению $(f, Q)$ и наоборот.
Пусть $\mu = \Pi[p, \sigma_1]$.
Так как для любого $B \in \Borel(I)$ выполнено
\begin{align*}
  \mu(X \in B \; | \; s = H) 
  &= \frac{\mu(X \in B, \; s = H)}{\mu(s = H)} = \\
  &= \int_0^1 \Ind{B} \frac{p(x)}{p} \sigma^M_1(\di x) =
  \int_0^1 \Ind{f^{-1}(B)} \frac{Q(u)}{p} \di u,
\end{align*}
то восстановить $\sigma_1$ по $(f, Q)$ можно следующим образом.
Если ходом случая было выбрано состояние $H$, то инсайдер выбирает $u \in [0, 1]$ как реализацию случайной величины с плотностью вероятности $Q(u)/p$ и делает ставку $x = f(u)$.
Аналогично, в состоянии $L$ он выбирает $u$ как реализацию случайной величины с плотностью вероятности $(1 - Q(u))/(1 - p)$ и делает ставку $x = f(u)$.

Введем обозначение
\[
  \Ff{y} = g_1(p, (f, Q), y) + \E \LV{n}(Q(U)).
\]
Переходя к $f$ и $Q$ в формуле~\eqref{ch3:eq:g1-aposterior}, получаем следующее равенство:
\begin{equation}\label{ch3:eq:F(f,Q,p)}
\begin{multlined}
  \Ff{y} =
  \int_0^1 \Ind{\{u | f(u) > y\}} (Q(u) - \Co f(u) - \DCo y) \di u \enskip + \\
  + \int_0^1 \Ind{\{u | f(u) < y\}} (\DCo f(u) + \Co y - Q(u)) \di u \; + \int_0^1
  \LV{n}(Q(u)) \di u.
\end{multlined}
\end{equation}

Как показано в \cite{demeyer02}, чтобы быть параметризацией некоторой одношаговой стратегии $\sigma_1$ первого игрока в игре $G_n(p)$, функции $f$ и $Q$ должны удовлетворять следующим свойствам:
\begin{subequations}
  \begin{flalign}
    \label{ch3:eq:parametr-prop:f-incr}
    &\bullet\quad f: [0, 1] \rightarrow [0, 1],\ \forall u_1, u_2 \in [0, 1]: u_1 < u_2 \implies f(u_1) \leqslant f(u_2); &\\
    \label{ch3:eq:parametr-prop:int-q=p}
    &\bullet\quad \int_0^1 Q(u) \di u = p;\ Q(u) \geqslant 0,\ u \in [0, 1];&\\
    \label{ch3:eq:parametr-prop:f-Q-eq}
    &\bullet\quad \forall u_1, u_2 \in [0, 1]: f(u_1) = f(u_2) \implies Q(u_1) = Q(u_2).&
  \end{flalign}
\end{subequations}
Условия (\ref{ch3:eq:parametr-prop:f-incr},~\ref{ch3:eq:parametr-prop:int-q=p}) естественны.
Условие \eqref{ch3:eq:parametr-prop:f-Q-eq} необходимо для того, чтобы случайная величина $Q(U)$ была измеримой относительно $\sigma$-алгебры, порожденной случайной величиной $X$.

Переформулируем лемму~\ref{ch3:lem:low-bound-primal} в терминах $f$ и $Q$.
\begin{lemma}
  Для любого $p \in [0, 1]$ выполняется неравенство
  \[
    \LV{n+1}(p) \geqslant \sup_{(f, \; Q)} \inf_{y} \Ff{y},
  \]
  где $f$ и $Q$ удовлетворяют~\eqref{ch3:eq:parametr-prop:f-incr} "--- \eqref{ch3:eq:parametr-prop:f-Q-eq}.
\end{lemma}

Будем искать пару $(f, Q)$, выравнивающую выигрыш первого игрока при $y \in [f(0), f(1)]$.
Пусть $y = f(\alpha)$ для некоторого $\alpha \in [0, 1]$, и $f$ возрастает в некоторой окрестности точки $\alpha$.
Тогда для выравнивающей пары $(f, Q)$ выражение
\begin{multline}\label{ch3:eq:F(f,Q,fa)}
  \Ff{f(\alpha)} = \int_\alpha^1 \left( Q(u) - \Co f(u) - \DCo f(\alpha)
  \right) \di u \; + \\
  + \int_0^\alpha \left( \DCo f(u) + \Co f(\alpha) - Q(u) \right) \di u +
  \int_0^1 \LV{n}(Q(u)) \di u,
\end{multline}
не зависит от $\alpha$. Следовательно,
\begin{align*}
  \frac{\partial F_{n+1}}{\partial \alpha}
  = (\alpha - \DCo) f'(\alpha) + 2 f(\alpha) - 2 Q(\alpha)
  = 0.
\end{align*}
Отсюда
\begin{equation}
  \label{ch3:eq:f}
  f(u) = (u - \DCo)^{-2} \int_{\DCo}^u 2(v-\DCo) Q(v) \di v.\footnotemark
  \footnotetext{
    При $u = \DCo$ функция $f(u)$ доопределяется по правилу Лопиталя как $Q(\DCo)$.
  }
\end{equation}%

Если подставить \eqref{ch3:eq:f} в \eqref{ch3:eq:F(f,Q,fa)}, то получившееся выражение $\Phi(Q)$ зависит только от $Q$ и не зависит от $\alpha$.
При $\alpha = 1$ получим
\begin{equation}\label{ch3:eq:Phi(a=1)}
  \begin{gathered}
    \Phi(Q) = \int_0^1 (\DCo f(u) + \Co f(1) - Q(u)) \di u + \int_0^1
    \LV{n}(Q(u)) \di u.
  \end{gathered}
\end{equation}
Аналогично при $\alpha = 0$ для $\Phi(Q)$ имеет место формула
\begin{equation}\label{ch3:eq:Phi(a=0)}
  \begin{gathered}
    \Phi(Q) = \int_0^1 (Q(u) - \Co f(u) - \DCo f(0)) \di u + \int_0^1
    \LV{n}(Q(u)) \di u.
  \end{gathered}
\end{equation}

\begin{lemma}\label{ch3:lem:Phi}
  Для $\Phi(Q)$ справедливо следующее представление:
  \begin{equation}\label{ch3:eq:Phi(Q)}
    \Phi(Q) = \int_0^1 (2u - 1) Q(u) \di u + \int_0^1 \LV{n}(Q(u)) \di u.
  \end{equation}
\end{lemma}
\begin{proof}
  Упростим \eqref{ch3:eq:Phi(a=1)} при $\Co \in (0, 1)$. Случаи $\Co = 0$ и $\Co = 1$ дают тот же результат и рассматриваются аналогично.

  Найдем выражение для $\int_0^1 f(u) \di u = \int_0^\DCo f(u) \di u + \int_\DCo^1 f(u) \di u$, разбив этот интеграл на две части.
  Для первой части имеем:
  \begin{multline*}
    \int_0^\DCo f(u) \di u = \int_0^\DCo (u - \DCo)^{-2} \int_\DCo^u 2(s - \DCo) Q(s) \di s = \\
    = \int_0^\DCo 2 (\DCo - s) Q(s) \int_0^s (\DCo - u)^{-2} \di u \di s =
    (2/\DCo) \int_0^\DCo u Q(u) \di u.
  \end{multline*}
  Аналогично, для второй части получаем
  \begin{gather*}
    \int_\DCo^1 f(u) \di u = (2/\Co) \int_\DCo^1 (1-u) Q(u) \di u.
  \end{gather*}
  Подставим найденные выражения в~\eqref{ch3:eq:Phi(a=1)}:
  \begin{multline*}
    \Phi(Q) = 2 \int_0^\DCo u Q(u) \di u + (2\DCo/\Co) \int_\DCo^1 (1-u) Q(u) \di u \; + \\
    + (2/\Co) \int_\DCo^1 (u - \DCo) Q(u) \di u - \int_0^1 Q(u) \di u + \int_0^1
    \LV{n}(Q(u)) \di u.
  \end{multline*}
  %
  Приведя подобные с учетом равенства $\DCo (1-u) + u - \DCo = \Co u$, получим
  \eqref{ch3:eq:Phi(Q)}.
\end{proof}

Найдем $Q$ как экстремаль следующей изопериметрической вариационной задачи:
\begin{align}
  \label{ch3:eq:Q-Problem}
  \Phi(Q) \rightarrow \max, \quad
  \int_0^1 Q(u) \di u = p.
\end{align}
Обозначим функцию Лагранжа заданной вариационной задачи через
\[
  L(u, Q, \lambda) = (2u - 1) Q(u) + \LV{n}(Q(u)) - \lambda Q(u).
\]
По предположению $\LV{n}$ --- непрерывно дифференцируемая функция.
Тогда функция $Q$, доставляющая экстремум в задаче \eqref{ch3:eq:Q-Problem}, удовлетворяет уравнению Эйлера для данной функции Лагранжа (\seename~\cite{elsgolc69}):
\begin{gather*}
  \frac{\partial L}{\partial Q} - \frac{\partial}{\partial u} \frac{\partial L}{\partial Q'}
  = 2u - 1 - \lambda + \LV[\prime]{n}(Q(u)) = 0,\\
  \int_0^1 Q(u) \di u = p.
\end{gather*}
Воспользовавшись свойством \eqref{ch3:eq:subdiff-props} о связи между субдифференциалами сопряженных функций, получим
\begin{align}
  \label{ch3:eq:Q(u)}
  &Q(u) = \LV[*\prime]{n}(1+\lambda-2u),\\
  %
  \label{ch3:eq:lambda-cond}
  &\int_0^1 \LV[ *\prime ]{n}(1+\lambda-2u) \di u = p.
\end{align}
Так как $\LV{n}$ определена на $[0, 1]$, то из~\eqref{ch3:eq:dual-range} следует, что
\begin{equation*}
  (0, 1)
  = \mathrm{int} \left( \dom \LV{n} \right)
  \subset \range \partial \LV[*]{n}
  \subset \dom \LV{n} = [0, 1],
\end{equation*}
и $\LV[ *\prime ]{n}$ не возрастает на $\mathbb{R}$ от $1$ до $0$.
Тогда при достаточно больших по модулю отрицательных $\lambda$ интеграл близок к $1$, а при достаточно больших положительных $\lambda$ интеграл близок к 0.
Таким образом, $\lambda$, удовлетворяющее~\eqref{ch3:eq:lambda-cond}, существует.

Введем обозначение
\begin{equation*}
  K(\lambda) = \int_0^1 \LV[*]{n}(1+\lambda-2u) \di u.
\end{equation*}
Доказательство следующей леммы аналогично \cite{demeyer02} и приводится в целях полноты изложения.
\begin{lemma}
  Имеет место следующее равенство
  \begin{equation}\label{ch3:eq:phi=k*}
    \Phi(Q) = K^*(p).
  \end{equation}
\end{lemma}
\begin{proof}
  Из (\ref{ch3:eq:Phi(Q)}) имеем
  \begin{align*}
    \Phi(Q)
    &= \lambda \int_0^1 Q(u) \di u
    - \int_0^1 \left[ (1+\lambda-2u) Q(u) + \LV{n}(Q(u)) \right] \di u.
  \end{align*}
  В силу \eqref{ch3:eq:subdiff-props} и (\ref{ch3:eq:Q(u)}) справедливо равенство
  \begin{equation*}
    (1+\lambda-2u) Q(u) - \LV{n}(Q(u)) = \LV[*]{n}(1+\lambda-2u),
  \end{equation*}
  из которого следует, что
  \begin{align*}
    \Phi(Q)
    = \lambda \int_0^1 Q(u) \di u - \int_0^1 \LV[*]{n}(1+\lambda-2u) \di u = \lambda p - K(\lambda).
  \end{align*}
  Далее, из определения $K(\lambda)$ и (\ref{ch3:eq:lambda-cond}) находим
  \[
    K'(\lambda) = \int_0^1 \LV[*\prime]{n}(1+\lambda-2u) \di u = p.
  \]
  Отсюда и из \eqref{ch3:eq:subdiff-props} получаем, что $\Phi(Q) = K^*(p)$.
\end{proof}

Отметим, что хотя функция $f(u)$ зависит от коэффициента $\Co$, выражения для функций $Q(u)$ и $\Phi(Q)$ от него не зависят и по форме совпадают с аналогичными выражениями в \cite{demeyer02}.
Данный факт позволит нам без изменений использовать соотношения из \cite{demeyer02} между нижними значениями прямой и двойственной игр.
Но прежде нужно показать, что полученные $f$ и $Q$ удовлетворяют условиям~\eqref{ch3:eq:parametr-prop:f-incr} "--- \eqref{ch3:eq:parametr-prop:f-Q-eq} и доставляют гарантированный выигрыш первого игрока, равный $K^*(p)$.

\begin{lemma}
  \label{ch3:lem:f-Q-is-strategy}
  Функции $f$ и $Q$\textnormal{,} определенные в~\eqref{ch3:eq:f} и \eqref{ch3:eq:Q(u)}\textnormal{,} принимают значения в $[0, 1]$ и удовлетворяют условиям~\eqref{ch3:eq:parametr-prop:f-incr} "--- \eqref{ch3:eq:parametr-prop:f-Q-eq}\textnormal{,} т.е. параметризуют некоторое распределение $\sigma_1$.
\end{lemma}
\begin{proof}
  Так как $\LV[ *\prime ]{n}$ не возрастает от $1$ до $0$, то $Q$ принимает значения в $[0, 1]$ и в силу \eqref{ch3:eq:Q(u)} не убывает на $[0, 1]$.

  Далее, из \eqref{ch3:eq:f} вытекает, что $f(u)$ является математическим ожиданием случайной величины $Q(V)$, где $V$ -- случайная величина, распределенная на отрезке $[\DCo, u]$ ($[u, \DCo]$) при $\DCo < u$ ($u < \DCo$) с плотностью $2|v-\DCo|/(u-\DCo)^2$.
  Следовательно, $f$ также принимает значения в $[0, 1]$.

  Сделаем замену переменной $t = (v - \DCo)/(u - \DCo)$ в \eqref{ch3:eq:f}. Тогда
  \begin{equation*}
    f(u) = \int_0^1 2 t Q \left( t(u - \DCo) + \DCo \right) \di t.
  \end{equation*}
  При $u_1 < u_2$ получаем
  \begin{equation}
    \label{ch3:eq:fu2-u1}
    f(u_2) - f(u_1) =
    \int_0^1 2t \left( 
      Q(t u_2 + \DCo(1-t)) - Q(t u_1 + \DCo (1-t))
    \right) \di t.
  \end{equation}
  Отсюда, в силу того, что $Q$ не убывает, получаем, что~\eqref{ch3:eq:parametr-prop:f-incr} выполнено.
  Далее, \eqref{ch3:eq:parametr-prop:int-q=p} следует из~\eqref{ch3:eq:lambda-cond}.
  Чтобы доказать \eqref{ch3:eq:parametr-prop:f-Q-eq}, рассмотрим несколько случаев.

  Пусть $\DCo < u_1 < u_2$ и $f(u_1) = f(u_2)$.
  Так как $Q$ не убывает, то подынтегральная функция из~\eqref{ch3:eq:fu2-u1} неотрицательная при $t \in [0, 1]$. 
  Отсюда получаем, что почти при всех $t \in [0, 1]$ выполнено $ Q(t(u_2 - \DCo) + \DCo) = Q(t(u_1 - \DCo) + \DCo)$.
  Из непрерывности $Q$ следует равенство при $t = 1$, то есть $Q(u_1) = Q(u_2)$.
  Случай $u_1 = \DCo$ получается предельным переходом по $u_1 \rightarrow \DCo$.

  Доказательство при $u_1 < u_2 \leqslant \DCo$ и $u_1 < \DCo < u_2$ проводится аналогично.
  Таким образом, \eqref{ch3:eq:parametr-prop:f-Q-eq} выполнено.
\end{proof}

\begin{lemma}
  \label{ch3:lem:f=Q}
  Если $f(u_1) = f(u_2)$ при $u_1 < u_2$, то $f(u) = Q(u)$ при $u \in [u_1, u_2]$.
\end{lemma}
\begin{proof}
  При $u_2 = \DCo$ справедливость утверждения следует из того, что $f(u_2) = Q(u_2)$.
  Пусть $u_2 \neq \DCo$. 
  Если $f(u_1) = f(u_2)$, то из леммы~\ref{ch3:lem:f-Q-is-strategy} следует, что $f$ и $Q$ постоянны на $[u_1, u_2]$.
  Тогда из \eqref{ch3:eq:f} имеем
  \begin{align*}
    f(u_2)
    &= (u_2 - \DCo)^{-2} \int_\DCo^{u_2} 2 (v - \DCo) Q(v) \di v = \\
    &= (u_2 - \DCo)^{-2} \left(
      \int_\DCo^{u_1} 2 (v - \DCo) Q(v) \di v \, +
      \int_{u_1}^{u_2} 2 (v - \DCo) Q(v) \di v
      \right) = \\
    &= (u_2 - \DCo)^{-2} \left(
      (u_1 - \DCo)^2 f(u_1) +
      \int_{u_1}^{u_2} 2 (v - \DCo) Q(u_1) \di v
      \right) = \\
    &= (u_2 - \DCo)^{-2} \left(
      (u_1 - \DCo)^2 f(u_1) +
      \left( (u_2 - \DCo)^2 - (u_1 - \DCo)^2 \right) Q(u_1)
      \right).
  \end{align*}
  С другой стороны, для $f(u_1)$ справедливо
  \begin{equation*}
    f(u_1) = (u_2 - \DCo)^{-2} \left(
      (u_1 - \DCo)^2 f(u_1) +
      \left( (u_2 - \DCo)^2 - (u_1 - \DCo)^2 \right) f(u_1)
    \right).
  \end{equation*}
  Отсюда находим
  \begin{equation*}
    f(u_2) - f(u_1) = \left(1 - \frac{(u_1 - \DCo)^2}{(u_2 - \DCo)^2}\right)(Q(u_1) - f(u_1)) = 0.
  \end{equation*}
  Таким образом, $f(u_1) = Q(u_1)$.
  Следовательно $f(u) = Q(u)$ при $u \in [u_1, u_2]$.
\end{proof}

\begin{theorem}\label{ch3:thm:V-bound}
  При любом $p \in [0, 1]$ для нижнего значения игры $G_{n+1}(p)$ справедлива оценка $\LV{n+1}(p) \geqslant K^*(p)$.
\end{theorem}
\begin{proof}
  В силу леммы~\ref{ch3:lem:low-bound-primal} достаточно доказать, что для функций $f$ и $Q$, определенных равенствами \eqref{ch3:eq:f} и \eqref{ch3:eq:Q(u)}, при любом $y \in [0, 1]$ выполнено $\Ff{y} \geqslant K^*(p)$.
  Рассмотрим несколько случаев.

  Пусть $y < f(0)$.
  Тогда из~(\ref{ch3:eq:F(f,Q,p)},~\ref{ch3:eq:phi=k*},~\ref{ch3:eq:Phi(a=0)}) получаем неравенство
  \begin{align*}
    \Ff{y} 
    &= \int_0^1 \left[ 
      Q(u) - \Co f(u) - \DCo y 
    \right] \di u +
    \int_0^1 \LV{n}(Q(u)) \di u \geq \\
    &\geq \int_0^1 \left[ 
      Q(u) - \Co f(u) - \DCo f(0) 
    \right] \di u + \int_0^1 \LV{n}(Q(u)) \di u = \\
    &= \Phi(Q) = K^*(p).
  \end{align*}
  Аналогично можно показать, что при $y > f(1)$ из~(\ref{ch3:eq:Phi(a=1)}) следует
  \begin{align*}
    \Ff{y} 
    &\geq \int_0^1 \left[ 
      \DCo f(u) + \Co f(1) - Q(u) 
    \right] \di u + \int_0^1 \LV{n}(Q(u)) \di u = \\
    &= \Phi(Q) = K^*(p).
  \end{align*}
  Пусть теперь $y = f(\alpha), \; \alpha \in [0, 1]$. Введем обозначения
  \[
    \alpha^- = \min \left\{ v \;|\; f(v) = f(\alpha) \right\}, \quad \alpha^+ =
    \max \left\{ v \;|\; f(v) = f(\alpha) \right\}.
  \]
  Подстановкой в~\eqref{ch3:eq:F(f,Q,p)} получаем
  \begin{multline}\label{ch3:eq:V-lower:alpha-0-1}
    \Ff{y} =
    \int_{\alpha^+}^1  (Q(u) - \Co f(u) - \DCo f(\alpha)) \di u \; + \\
    + \int_0^{\alpha^-} (\DCo f(u) + \Co f(\alpha) - Q(u)) \di u \; + \int_0^1
    \LV{n}(Q(u)) \di u.
  \end{multline}
  Однако, из леммы~\ref{ch3:lem:f=Q} следует, что $Q(u) = f(\alpha)$ при $u \in [\alpha^-, \alpha^+]$.
  Поэтому~\eqref{ch3:eq:V-lower:alpha-0-1} совпадает с~\eqref{ch3:eq:F(f,Q,fa)} и $\Ff{y} = \Phi(Q) = K^*(p)$ по построению.
\end{proof}

\subsection{Оценка нижнего значения игры $\mathbf{G^*_n(z)}$}
\label{ch3:sec:-dual-game}

Аналогично тому, как это было сделано для первого игрока, параметризуем $\tau_1$ при помощи неубывающей функции $h: [0, 1] \rightarrow [0, 1]$.
Если $F_{\tau_1}(y)$ "--- функция распределения ставки $Y$ при применении вторым игроком стратегии $\tau_1$, то положим
\begin{equation*}
  h(u) = F^{-1}_{\tau_1}(u) \eqdef \inf \{ y\ |\ F_{\tau_1}(y) \geq u \}.
\end{equation*}
Тогда, если случайная величина $U$ равномерно распределена на $[0, 1]$, то $h(U)$ и $Y$ имеют одинаковое распределение.

Подобно предыдущему подразделу получим аналог леммы~\ref{ch3:lem:low-bound-dual:general} в терминах $h$.
Заметим, что для $g_1^L(x, \tau_1)$ и $g_1^H(x, \tau_1)$ справедливы равенства
\begin{align*}
  g_1^L(x,\tau_1) &=
                      \int_J \biggl[
                      \Ind{x>y} (-\Co x - \DCo y) +
                      \Ind{x<y} (\DCo x + \Co y)
                      \biggr] \tau_1(\di y),\\
  g_1^H(x,\tau_1) &=
                      \int_J \biggl[
                      \Ind{x>y} (1 -\Co x - \DCo y) +
                      \Ind{x<y} (\DCo x + \Co y - 1)
                      \biggr] \tau_1(\di y).
\end{align*}

Подставим $g_1^H(x, \tau_1)$ и $g_1^L(x,\tau_1)$ в правую часть~\eqref{ch3:eq:low-bound-dual:general} и получившийся результат обозначим как
\begin{equation}\label{eq:W-low-bound:parameterized}
\begin{multlined}
  \Gf[x][h] =
  \LW{n}\left( 
    z - \int_0^1 \left[ \Ind{\{h(u) < x\}} - \Ind{\{h(u) > x\}} \right] \di u
  \right) \; - \\
  - \int_0^1 \left[ 
    \Ind{\{h(u) < x\}} (-\Co x - \DCo h(u)) + 
    \Ind{\{h(u) > x\}} (\DCo x + \Co h(u)) 
  \right] \di u.
\end{multlined}
\end{equation}

\begin{lemma}\label{ch3:lem:W-low-bound:parameterized}
  Для любого $z \in \mathbb{R}$ выполнено неравенство
  \begin{equation*}
    \LW{n+1}(z) \geqslant \sup_h \inf_{x} \Gf[x][h].
  \end{equation*}
\end{lemma}

Будем искать стратегию второго игрока, выравнивающую его выигрыш при $x \in [h(0), h(1)]$.
Пусть $x = h(\alpha)$ для некоторого $\alpha \in [0, 1]$, и $h$ возрастает в некоторой окрестности точки $\alpha$.
Тогда для выравнивающей функции $h$ выражение
\begin{equation}\label{ch3:eq:G(ha)}
\begin{multlined}
  \Gf[h(\alpha)][h] =
  \LW{n}(z + 1 - 2\alpha) - \\
  - \int_\alpha^1 \biggl( \DCo h(\alpha) + \Co h(u) \biggr) \di u +
  \int_0^\alpha \biggl( \Co h(\alpha) + \DCo h(u) \biggr) \di u.
\end{multlined}
\end{equation}
не зависит от $\alpha$. Следовательно,
\begin{equation*}
  \frac{\partial G_{n+1}}{\partial \alpha} =
  2h(\alpha) + (\alpha - \DCo)h'(\alpha) - 2 \LW[\prime]{n}(z - 2\alpha + 1) = 0.
\end{equation*}
Отсюда
\begin{equation}\label{ch3:eq:h(u)}
  h(u) = 2(u - \DCo)^{-2} \int_\DCo^u (v - \DCo) \LW[\prime]{n}(z - 2v + 1) \di v.\footnotemark
  \footnotetext{При $u = \DCo$ доопределим $h(\DCo)$ по непрерывности как $\LW[\prime]{n}(z - 2\DCo + 1)$.}
\end{equation}
Если подставить $h(u)$ в~\eqref{ch3:eq:G(ha)} то получившееся выражение, которое мы обозначим $\Psi(h)$, не зависит от $\alpha$.
Доказательство следующей леммы аналогично доказательству леммы~\ref{ch3:lem:Phi}.

\begin{lemma}
  Для значения $\Psi(h)$ справедливо равенство
  \begin{equation}
    \Psi(h) = \int_0^1 \LW{n}(z - 2s + 1) \di s.
  \end{equation}
\end{lemma}

Отметим, что несмотря на зависимость $h(u)$ от $\beta$, выражение для функции $\Psi(h)$ от него не зависит и по форме совпадает с аналогичным выражением в~\cite{demeyer02}.
Таким образом, остается показать, что функция $h$ действительно является параметризацией некоторой стратегии $\tau_1$ второго игрока, и нижняя оценка его выигрыша равна $\Psi(h)$.
Доказательство следующей леммы опускается, поскольку во многом повторяет доказательства лемм~\ref{ch3:lem:f-Q-is-strategy} и~\ref{ch3:lem:f=Q}.
\begin{lemma}\label{ch3:lem:h(u)-props}
  Функция $h,$ определенная в~\eqref{ch3:eq:h(u)}$,$ обладает следующими свойствами$:$
  \begin{itemize}
  \item[$\bullet$] 
    $h: [0, 1] \rightarrow [0, 1],\ \forall u_1, u_2 \in [0, 1]: u_1 < u_2 \implies h(u_1) \leq h(u_2);$ 
  \item[$\bullet$] 
  $h(u_1) = h(u_2) \implies h(u_1) = \LW[\prime]{n}(z - 2u_1 + 1) = \LW[\prime]{n}(z - 2u_2 + 1)$.
  \end{itemize}
  В частности$,$ функция $h$ может служить параметризацией некоторого распределения $\tau_1$.
\end{lemma}

\begin{theorem}\label{ch3:thm:W-bound}
  Для нижнего значения игры $G_{n+1}^*(z)$ справедлива оценка
  \begin{equation*}
    \LW{n+1}(z) \geqslant \int_0^1 \LW{n}(z - 2v + 1) \di v.
  \end{equation*}
\end{theorem}
\begin{proof}
  Из леммы~\ref{ch3:lem:W-low-bound:parameterized} следует, что нам достаточно показать, что при любом $x \in [0, 1]$ выполнено $\Gf[x][h] \geqslant \Psi(h)$.
  Рассмотрим несколько случаев.

  При $x < h(0)$ из~\eqref{eq:W-low-bound:parameterized} и~\eqref{ch3:eq:G(ha)} получаем
  \begin{multline*}
    \Gf[x][h] =
    \LW{n}(z + 1) - \int_0^1 \left( \DCo x + \Co h(u) \right) \di u \geqslant \\
    \geqslant \LW{n}(z + 1) - \int_0^1 \left( \DCo h(0) + \Co h(1) \right) \di
    u = \Gf[h(0)][h] = \Psi(h).
  \end{multline*}

  Аналогично можно показать, что при $x > h(1)$ выполняется неравенство $\Gf[x][h] \geqslant \Psi(h)$.

  Пусть теперь $x = h(\alpha), \; \alpha \in [0, 1]$. Введем обозначения
  \[
    \alpha^- = \min \left\{ v \;|\; h(v) = h(\alpha) \right\}, \quad \alpha^+ =
    \max \left\{ v \;|\; h(v) = h(\alpha) \right\}.
  \]
  Из~\eqref{eq:W-low-bound:parameterized} находим
  \begin{multline}\label{ch3:eq:g+-}
    \Gf[x][h] = \LW{n}(z + 1 - \alpha^- - \alpha^+) \enskip - \\
    - \int_0^{\alpha^-} \left(-\Co x - \DCo h(u)\right) \di u -
    \int_{\alpha^+}^1 \left(\DCo x + \Co h(u)\right) \di u.
  \end{multline}
  Поскольку $\LW{n}$ "--- дифференцируемая вогнутая функция, верно неравенство
  \begin{multline*}
    \LW{n}(z + 1 - 2\alpha) \leqslant \LW{n}(z + 1 - \alpha^- - \alpha^+) \enskip +\\
    + \LW[\prime]{n}(z + 1 - \alpha^- - \alpha^+) \left( [ \alpha^+ - \alpha ] + [
      \alpha^- - \alpha ] \right).
  \end{multline*}
  Из леммы~\ref{ch3:lem:h(u)-props} при $u_1 = (\alpha^- + \alpha^+)/2,\: u_2 = \alpha$ следует, что
  \[
    \LW[\prime]{n}(z + 1 - \alpha^- - \alpha^+) = \LW[\prime]{n}(z + 1 - 2\alpha) =
    h(\alpha).
  \]
  Так как $h(u)$ постоянна на $[\alpha^-, \alpha^+]$ и $h(\alpha) = x$ имеем
  \begin{multline*}
    \LW{n}(z + 1 - \alpha^- - \alpha^+) \geqslant \LW{n}(z + 1 - 2\alpha) - \\
    - \int_\alpha^{\alpha^+} \left( \DCo x + \Co h(u) \right) \di u +
    \int_{\alpha^-}^\alpha \left( \Co x + \DCo h(u) \right) \di u.
  \end{multline*}
  Используя оценку на $\LW{n}(z + 1 - \alpha^- - \alpha^+)$ в \eqref{ch3:eq:g+-}, получаем
  \begin{multline*}
    \Gf[x][h] \geqslant \LW{n}(z + 1 - 2\alpha)
    - \int_\alpha^1 \biggl( \DCo h(\alpha) + \Co h(u) \biggr) \di u \; + \\
    + \int_0^\alpha \biggl( \Co h(\alpha) + \DCo h(u) \biggr) \di u =
    \Gf[h(\alpha)][h] = \Psi(h).
  \end{multline*}
  Таким образом, требуемое неравенство справедливо при любом $x \in [0, 1]$.
\end{proof}

\section{Значение игры $\mathbf{G_n\left(p\right)}$}
\label{ch3:sec:game-value}

Поскольку выражения для нижних оценок в теоремах~\ref{ch3:thm:V-bound} и~\ref{ch3:thm:W-bound} совпадают с аналогичными выражениями в \cite{demeyer02}, справедливы все двойственные соотношения между $\LV{n}(p)$ и $\LW{n}(z)$, а также утверждения относительно оптимальности стратегий.
Приведем соответствующие теоремы.

\begin{theorem}
  Для всех $z \in \mathbb{R}$ выполнено
  \begin{equation}\label{ch3:eq:duality-relationships}
    \LV[*]{n}(z) = \HW{n}(z) = \HV[*]{n}(z) = \LW{n}(z).
  \end{equation}
  Таким образом, игры $G_n(p)$ и $G_n^*(z)$ имеют значения $V_n(p)$ и $W_n(z)$ соответственно.
  Кроме того,
  \begin{equation}\label{ch3:eq:W-recursive}
    W_{n+1}(z) = \int_0^1 W_n(z - 2u + 1) \di u.
  \end{equation}
\end{theorem}

\begin{theorem}\label{ch3:thm:optimal-strategies}
  Стратегии $\sigma^0$ и $\tau^0$ являются оптимальными в игре $G_n(p)$ тогда и только тогда, когда стратегии $(p, \sigma^0),$ $\tau^0$ являются оптимальными в игре $G_n^*(z)$ при $z = V_n'(p)$.
\end{theorem}

\begin{corollary}
  \label{ch3:cor:value-indep-beta}
  Значения игр $G^\Co_n(p)$ и $G^{\Co*}_n(z)$ не зависят от коэффициента $\Co$.
\end{corollary}

Нужно отметить, что в силу следствия~\ref{ch3:cor:value-indep-beta} содержание утверждений об асимптотике значения игры и динамике апостериорных вероятностей справедливо и для данной модели без каких-либо изменений.
Приведем соответствующие утверждения.

Обозначим через $f_n$ функцию распределения суммы независимых случайных величин $S_n = \sum_{k=1}^n U_k / \sqrt{n}$, где случайные величины $U_k$ распределены равномерно на отрезке $[-1, 1]$.
Также введем обозначение $\psi_n(p) = V_n(p)/\sqrt{n}$.

\begin{proposition}[{{\cite[Следствие 3]{demeyer02}}}]
Пусть величина $v_p$ определяется из условия 
$
  p~=~\int_{v_p}^\infty f_n(s) \di s.
$
Тогда справедливы равенства
\begin{equation*}
  \psi_n(p) = \int_{v_p}^\infty s f_n(s) \di s, \enskip
  \psi'_n(p) = v_p.
\end{equation*}
\end{proposition}

Введем обозначение $\psi^*(v) = \E \min(0, v + Z/\sqrt{3})$, где $Z$ "--- случайная величина, имеющая стандартное нормальное распределение.

\begin{proposition}[{{\cite[Следствие 4]{demeyer02}}}]
Последовательности функций $\{\psi^*_n\}$ и $\{\psi^{*\prime}_n\}$ сходятся равномерно к $\psi^*$ и $\psi^{*\prime}$ соответственно.
Более того, последовательность функций $\{\psi_n(p)\}$ равномерно сходится к функции
\begin{equation*}
  \psi(p) = \frac{e^{-z_p^2/2}}{\sqrt{6\pi}},
\end{equation*}
где при каждом $p \in [0, 1]$ величина $z_p$ определяется из равенства
\begin{equation*}
  p = \int_{z_p}^\infty \frac{e^{-s^2/2}}{\sqrt{2\pi}} \di s.
\end{equation*}
\end{proposition}

Обозначим $p_m$ апостериорную вероятность состояния $H$ после $m$-го шага игры.
Кроме того, обозначим $p^n$ непрерывный случайный процесс, определенный для $t \in [0, 1]$ как $p^n_t = p_{[nt]}$.

\begin{proposition}[{{\cite[Теорема 12]{demeyer02}}}]
  Случайный процесс $p^n$ при $n \rightarrow \infty$ сходится в смысле конечномерных распределений к процессу $\vartheta_t$, который определяется следующим образом:
  \begin{align*}
    \vartheta_t &= \psi^{*\prime} \left(
      \frac{z_p' - B_t}{\sqrt{3}\sqrt{1-t}}
    \right) =
    N\left( \frac{z_p' - B_t}{\sqrt{1-t}} \right),\ t \in [0, 1)\\
    N(v) &= \int_{-\infty}^v \frac{e^{-s^2/2}}{\sqrt{2\pi}} \di s,
  \end{align*}
  где $B_t$ "--- стандартный винеровский процесс, а величина $z_p'$ определяется из уравнения $N(z_p') = p$.
\end{proposition}

\begin{proposition}[{{\cite[Лемма 9]{demeyer02}}}]
  Существует константа $C$ такая, что для всех $m, n$ при $m < n$ выполняется неравенство
  \begin{equation*}
    | x_m - p_m | \leq C / \sqrt{n - m},
  \end{equation*}
  где $x_m$ "--- ставка первого игрока на $m$-м шаге игры.
\end{proposition}

Обоснуем сделанные ранее предположения о непрерывной дифференцируемости функций $\LV{n}(p)$, $\LV[*]{n}(z)$ и $\LW{n}(z)$.

\begin{proposition}
  При любом $n \geqslant 1$ функция $W_n(z)$ является непрерывно дифференцируемой на $\mathbb{R}$.
\end{proposition}
Это сразу следует из формулы~\eqref{ch3:eq:W-recursive} и того, что $W_0(z) = \min(z, 0)$.
Рассмотрим подробнее, как ведет себя $W_n'(z)$.

\begin{lemma}\label{ch3:lem:W'-props}
  Для любого $n \geqslant 1$ выполняется\textnormal{:}
  \begin{enumerate}
  \item $W_n'(z) = 1$ при $z \in (-\infty, -n];$
  \item $W_n'(z) = 0$ при $z \in [n, \infty);$
  \item $W_n'(z)$ убывает при $z \in [-n, n].$
  \end{enumerate}
\end{lemma}
\begin{proof}
  Из~\eqref{ch3:eq:W-recursive} следует, что
  \begin{equation}\label{ch3:eq:W'-recursive}
    W_{n+1}'(z) = \frac{1}{2} \left( W_n(z + 1) - W_n(z - 1) \right).
  \end{equation}
  Отсюда
  \begin{equation}\label{ch3:eq:W1'}
    W_1'(z) =
    \begin{cases}
      1, &z < -1, \\
      (1-z)/2,  &-1 \leqslant z \leqslant 1, \\
      0, &z > 1.
    \end{cases}
  \end{equation}
  Таким образом, утверждение леммы верно при $n = 1$.
  Пусть также утверждение леммы верно при $n \leqslant N$, докажем его справедливость при $n = N + 1$.

  Из~\eqref{ch3:eq:W'-recursive} следует, что для некоторого $\Theta \in (-1,1)$ верно равенство
  \[
    W_{N+1}'(z) = W_{N}'(z + \Theta).
  \]
  Отсюда получаем справедливость первых двух утверждений леммы.
  Далее, из~\eqref{ch3:eq:W'-recursive} получаем 
  \[
    W_{N+1}''(z) = 1/2 \left( W_{N}'(z + 1) - W_{N}'(z - 1) \right).
  \]
  Так как $W_N'(z)$ убывает на $[-N, N]$, то $W_N'(z + 1)$ убывает на $[-N-1, N - 1]$, $W_N'(z - 1)$ убывает на $[-N + 1, N+1]$, а значит $W_{N+1}''(z)$ отрицательна при $z \in [-N-1, N+1]$.
  Отсюда получаем третье утверждение леммы.
\end{proof}

\begin{proposition}
  При любом $n \geqslant 1$ функция $V_n(p)$ является непрерывно дифференцируемой на $[0, 1]$.
\end{proposition}
\begin{proof}
  Из~\eqref{ch3:eq:subdiff-props} следует, что
  \begin{equation*}
    z_1^* \neq z_2^* \in \partial V_n(p) \iff p = W_n'(z_1^*) = W_n'(z_2^*).
  \end{equation*}
  Однако по лемме~\ref{ch3:lem:W'-props} функция $W_n'$ убывает от $1$ до $0$.
  Следовательно $\partial V_n$ содержит только одно значение в каждой точке отрезка $[0, 1]$, что эквивалентно дифференцируемости $V_n$.
  Из того, что $V_n$ к тому же непрерывна, ограниченна и вогнута, получаем непрерывность ее производной на $[0, 1]$.
\end{proof}

\noindent
\textbf{Алгоритм построения оптимальных стратегий в игре $\mathbf{G_n(p)}$}.
В силу рекурсивной структуры игры $G_n(p)$ достаточно описать способ получения оптимальных действий игроков на первом шаге игры при заданном значении $p$ вероятности состояния $H$.
\begin{enumerate}
\item
  Находим $\lambda$ как решение уравнения 
  $
    p = W'_n(\lambda).
  $
  Производная $W'_n$ является кусочно-полиномиальной функцией $n$-го порядка.
  Следовательно, ее корни могут быть найдены численно с любой заданной точностью.
\item
  Согласно~\eqref{ch3:eq:Q(u)} и~\eqref{ch3:eq:duality-relationships} находим функцию 
  \[
    Q(u) = W'_{n-1}(\lambda + 1 - 2u).
  \]
  В силу сказанного выше функция $Q(u)$ является кусочно-полиномиальной порядка $n-1$.
\item
  Выбираем $u_1$ как реализацию случайной величины $U_1$, распределенной на $[0, 1]$ с плотностью вероятности $Q(u)/p$ в состоянии $H$ и $\left(1 - Q(u)\right)/(1-p)$ в состоянии $L$.
\item
  Согласно~\eqref{ch3:eq:f} находим 
  \[
    x = f(u_1) = (u_1 - \DCo)^{-2} \int_\DCo^{u_1} 2 (v - \DCo) Q(v) \di v.
  \]
  Так как для расчета оптимальной ставки $x$ необходимо знать значение $f(u)$ лишь в одной точке $u$, оно может быть эффективно найдено численно.
\item
  Находим $u_2$ как реализацию случайной величины $U_2$, распределенной равномерно на $[0, 1]$
\item
  Из~\eqref{ch3:eq:h(u)} и теоремы~\ref{ch3:thm:optimal-strategies} следует, что выражения для $h$ и $f$ совпадают.
  Таким образом, оптимальная ставка второго игрока $y = h(u_2) = f(u_2)$.
\item
  Если $n = 1$, игра заканчивается после объявления ставок. В противном случае игроки переходят к игре $G_{n-1}(p^1)$, где $p^1 = Q(u_1)$.
\end{enumerate}

Из данного алгоритма видно, что возможность быстрого расчета оптимальных действий игроков на первом шаге зависит от возможности быстрого расчета функции $W_n'(z)$.
Укажем способ ее расчета.

В~\cite{demeyer02} показано, что $\psi^*_n(z) = \frac{1}{\sqrt{n}} W_n(\sqrt{n} z)$ и $\psi^{*\prime}_n(z) = P(S_n > z)$.
Отсюда получаем, что
\begin{equation}\label{ch3:eq:Wn'}
  \begin{aligned}
    W'_n(z)
    &= \psi^{*\prime}_n \left( \frac{z}{\sqrt{n}} \right) 
    = P\left( \frac{\sum_{i=1}^n U_i}{\sqrt{n}} > \frac{z}{\sqrt{n}} \right) = \\
    &= P\left( \sum_{i=1}^n U_i > z \right) 
    = 1 - F_{U_n}(z),
  \end{aligned}
\end{equation}
где $F_{U_n}(z)$ --- функция распределения суммы $n$ случайных величин, распределенных равномерно на отрезке $[-1, 1]$.
Известно, что $F_{U_n}(z)$ имеет следующее представление (\seename~\cite{feller67}):
\begin{equation}\label{ch3:eq:F_Un}
  F_{U_n}(z) = \frac{1}{2^n n!} \sum_{k=0}^n (-1)^k C_n^k (z + n - 2k)^n_+.
\end{equation}
Заметим, что при $z \in [-n + 2(i-1), -n + 2i],\ i = \overline{1, n}$ только $i$ членов в формуле выше отличны от нуля.
Потому для заданного $n$ можно заранее рассчитать коэффициенты полинома при попадании $z$ в тот или иной интервал.

В качестве иллюстрации использования \eqref{ch3:eq:Wn'} и \eqref{ch3:eq:F_Un} приведем формулы для $W_n'(z)$ при $n = \overline{2, 5}$:

\begin{equation}\label{ch3:eq:W2'}
  W_2'(z)
  = 
    \begin{cases}
      1,\ & z\leq -2, \\
      \frac{1}{8} \left(-z^2-4 z+4\right),\ & -2<z\leq 0, \\
      \frac{1}{8} (z-2)^2,\ & 0<z\leq 2, \\
      0,\ & z > 2,
    \end{cases}
\end{equation}
\begin{align*}
W_3'(z)
  &= 
    \begin{cases}
      1,\ & z\leq -3, \\
      \frac{1}{48} \left(-z^3-9 z^2-27 z+21\right),\ & -3<z\leq -1, \\
      \frac{1}{24} \left(z^3-9 z+12\right),\ & -1<z\leq 1, \\
      -\frac{1}{48} (z-3)^3,\ & 1<z\leq 3, \\
      0,\ & z > 3,
    \end{cases}\\
  W_4'(z)
  &=
    \begin{cases}
      1,\ & z\leq -4, \\
      \frac{1}{384} \left(-z^4-16 z^3-96 z^2-256 z+128\right),\ & -4<z\leq -2, \\
      \frac{1}{384} \left(3 z^4+16 z^3-128 z+192\right),\ & -2<z\leq 0, \\
      \frac{1}{384} \left(-3 z^4+16 z^3-128 z+192\right),\ & 0<z\leq 2, \\
      \frac{1}{384} (z-4)^4,\ & 2<z\leq 4, \\
      0,\ & z > 4,
    \end{cases}\\
  W_5'(z)
  &=
    \begin{cases}
      1,\ & z\leq -5, \\
      \frac{-z^5-25 z^4-250 z^3-1250 z^2-3125 z+715}{3840},\ & -5<z\leq -3, \\
      \frac{2 z^5+25 z^4+100 z^3+50 z^2-550 z+965}{1920},\ & -3<z\leq -1, \\
      \frac{-3 z^5+50 z^3-575 z+960}{1920},\ & -1<z\leq 1, \\
      \frac{2 z^5-25 z^4+100 z^3-50 z^2-550 z+955}{1920},\ & 1<z\leq 3, \\
      -\frac{(z-5)^5}{3840},\ & 3<z\leq 5, \\
      0,\ & z > 5.
    \end{cases}
\end{align*}

\section{Примеры}\label{ch3:sec:examples}

В данном разделе даны примеры использования описанного выше алгоритма при построении аналитического решения для игр $G_1(p)$ и $G_2(p)$.

\begin{example}
  Найдем оптимальные $f$ и $Q$ в игре $G_1(p)$.
  Из~\eqref{ch3:eq:W1'} получаем, что $\lambda = 1 - 2p$ является решением уравнения $p = W'_1(\lambda)$.
  Отсюда
  \begin{equation*}
    Q(u) = W'_0(\lambda + 1 - 2u) = \begin{cases}
      0, &\; u < 1 - p,\\
      1, &\; u > 1 - p.
    \end{cases}
  \end{equation*}
  Пусть $p \leq \Co$.
  Тогда из (\ref{ch3:eq:f}) находим
  \begin{align*}
    f(u) 
    &=
      (u - \DCo)^{-2} \int_{1-p}^u 2 (v - \DCo) Q(v) \di v = \\
    &=
      \begin{cases}
        0, &\; u \leqslant 1 - p,\\
        1 - {\displaystyle \frac{(\Co - p)^2}{(u-\DCo)^2}}, &\; u > 1 - p.
      \end{cases}
  \end{align*}
  При $p > \Co$ получаем
  \begin{equation*}
    f(u)= \begin{cases}
      {\displaystyle (u-\DCo)^{-2} \int_\DCo^{1-p} 2 (v - \DCo) \di v},\ & u \leq 1 - p,\\
      {\displaystyle (u - \DCo)^{-2} \int_\DCo^u 2 (v - \DCo) \di v},\ & u > 1 - p.
    \end{cases}                                                     
  \end{equation*}
  Отсюда
  \begin{equation*}
    f(u) = \begin{cases}
      {\displaystyle \frac{(\Co - p)^2}{(u - \DCo)^2}},\ & u \leq 1 - p,\\
      1,\ & u > 1 - p.
    \end{cases}  
  \end{equation*}
\end{example}

\begin{example}
  Найдем оптимальные $f$ и $Q$ в игре $G_2(p)$.
  Пусть $1/2 < p < 1$.
  Тогда из \eqref{ch3:eq:W2'} искомое $\lambda$ находится как решение следующего уравнения (\seename~рис.~\ref{ch3:fig:W2}):
  \[
  (4 - 4\lambda - \lambda^2)/8 = p.
  \]
  \begin{figure}[hbt]
    \centering \input{figures/ch3-w2}
    \caption{График функции $W_2'(z)$}
    \label{ch3:fig:W2}
  \end{figure}
  Отсюда $\lambda = -2 + 2\sqrt{2 - 2p}$, а следовательно имеет место равенство
  \begin{equation*}
    Q(u) =
    W'_1(\lambda + 1 - 2u) =
    \begin{cases}
      1 - \sqrt{2 - 2p} + u, &\; u < \sqrt{2 - 2p},\\
      1, &\; u \geqslant \sqrt{2 - 2p}.
    \end{cases}
  \end{equation*}
  Пусть $\DCo < \sqrt{2 - 2p}$. Тогда для $f$ имеет место следующая формула:
  \begin{equation*}
    f(u) = \begin{cases}
      {\displaystyle 1 - \frac{\sqrt{2 - 2p} + (2u + \DCo)}{3}}, &\; u \leqslant \sqrt{2 - 2p},\\
      {\displaystyle 1 - \frac{(\sqrt{2 - 2p} - \DCo)^3}{3(u - \DCo)^2}}, &\; u > \sqrt{2 - 2p}.
    \end{cases}
  \end{equation*}
  Пусть $\DCo > \sqrt{2-2p}$.
  В случае $u \geq \sqrt{2 - 2p}$ имеет место равенство $f(u) = 1$.
  Если $u < \sqrt{2 - 2p}$, то тогда выражение для $f(u)$ приобретает вид
  \begin{equation*}
    f(u) = (u-\DCo)^{-2} \left( 
      \int_\DCo^{\sqrt{2-2p}} 2(v-\DCo) \di v +
      \int_{\sqrt{2-2p}}^u 2(v-\DCo) (1-\sqrt{2 - 2p} + v) \di v
    \right).
  \end{equation*}
  Обозначим через $t$ выражение $\sqrt{2-2p}$.
  Тогда для первого слагаемого получим
  \begin{equation*}
      \int_\DCo^t 2(v-\DCo) \di v = (\DCo - t)^2.
  \end{equation*}
  Для второго слагаемого находим
  \begin{equation*}
    \int_t^u 2(v - \DCo) (1 - t + v) \di v = \frac{1}{3} (t - u)(t^2 - t(3-u) - u(3 + 2u) + 3(2-t+u)\DCo).
  \end{equation*}
  Отсюда, получаем для $f(u)$ следующее выражение
  \begin{equation*}
    f(u) = 1 - \frac{(t-u)^2(3\DCo - t - 2u)}{3(u-\DCo)^2}.
  \end{equation*}
  Таким образом, при $\DCo > \sqrt{2-2p}$ функция $f(u)$ имеет следующим вид
  \begin{equation*}
    f(u) = \begin{cases}
      {\displaystyle 1 - \frac{(\sqrt{2-2p}-u)^2(3\DCo - \sqrt{2-2p} - 2u)}{3(u-\DCo)^2}},\ & u < \sqrt{2-2p}, \\
      1,\ & u \geq \sqrt{2-2p}.
    \end{cases}
  \end{equation*}
  
  Пусть $0 < p \leq 1/2$.
  Тогда искомое $\lambda$ находится как решение следующего уравнения (\seename~рис.~\ref{ch3:fig:W2}):
  \begin{equation*}
    (\lambda - 2)^2/8 = p.
  \end{equation*}
  Отсюда $\lambda = 2(1-\sqrt{2p})$, и из~(\ref{ch3:eq:W1'}) получаем
  \begin{equation*}
    Q(u) = W'_1(\lambda + 1 - 2u) = \begin{cases}
      0,\ & u \leq 1 - \sqrt{2p},\\
      1 - \sqrt{2p} + u,\ & u > 1 - \sqrt{2p}.
    \end{cases}
  \end{equation*}
  
  Пусть $\DCo \leq 1 - \sqrt{2p}$.
  При $u \leq 1 - \sqrt{2p}$ справедливо $f(u) = 0$.
  При $u > 1 - \sqrt{2p}$ находим
  \begin{align*}
    f(u) 
    &= (u-\DCo)^{-2} \int_{1-\sqrt{2p}}^u 2 (v-\DCo) (1-\sqrt{2p}+v) \di v = \\
    &= \frac{(u - 1 + \sqrt{2p})(2(u^2 + u - 2) + 10p - \sqrt{2p}(1+5u+9\Co) + 3(3+u)\Co)}{3(u-\DCo)^2}.
  \end{align*}
  При $\DCo > 1 - \sqrt{2p}$ для $f$ имеет место следующая формула
  \begin{equation*}
    f(u) =
    \begin{cases}
      {\displaystyle \frac{(5(\sqrt{2p}-1) - \DCo)(\sqrt{2p} - \Co)^2}{3(u - \DCo)^2}},\ & u \leq 1 - \sqrt{2p}, \\
      1 - \sqrt{2p} + {\displaystyle \frac{2u + \DCo}{3}},\ & u > 1 - \sqrt{2p}.
    \end{cases}
  \end{equation*}
\end{example}

Как видно из данных примеров, получение явного аналитического представления функций $f$ и $Q$ в $n$-шаговой игре является трудоемкой задачей.
}

%%% Local Variables:
%%% TeX-master: "../dissertation"
%%% End:
