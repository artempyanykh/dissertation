\chapter{Теоретико-игровая модель биржевых торгов с непрерывными ставками для
  рынка с двумя состояниями} \label{chapt2}%
{
\newcommand{\Port}[1]{y_{#1}}
\newcommandx*\Ff[3][1={(f, Q)}, 2=n+1]{\ensuremath{F_{#2} \left(p, #1, #3 \right)}}
\newcommand*\dualFPS{\ensuremath{(p,\ \sigma)}}
\newcommandx*\dualg[4][1=n, 2={\dualFPS}, 3=x, 4=\tau]{\ensuremath{g^*_{#1}(#3, #2, #4)}}
\newcommandx*\Gf[2][1=i, 2=\tau_1]{\ensuremath{G_{n+1} \left(x, #1, #2 \right)}}

В разделах~\ref{ch2:sec:model-descr} и~\ref{ch2:sec:formal-descr} приводится описание модели биржевых торгов с вещественными ставками и теоретико-игровая постановка основной задачи и двойственной к ней в смысле Де~Мейера.
В разделе~\ref{ch2:sec:1st} получено решение одношаговой игры, на примере которой демонстрируются идеи, использованные при решении $n$-шаговой игры.
В разделе~\ref{ch2:sec:value-bounds} построены выравнивающие стратегии первого и второго игроков и получены оценки выигрыша в прямой и двойственной играх.
В разделе~\ref{ch2:sec:game-value} даны теоремы о значении игры и приведены асимптотические свойства последовательности апостериорных вероятностей при стремлении числа шагов к бесконечности.

Основные результаты данной главы опубликованы в работе \cite{pyanykh16:cont} в журнале из перечня ВАК.

\section{Описание модели}
\label{ch2:sec:model-descr}

Рассматриваемая в текущей главе модель биржевых торгов, аналогична модели из главы~\ref{chapt1}, за исключением того, что теперь игроки теперь могут делать произвольные вещественные ставки из отрезка $[0, 1]$.
В отличие от дискретной модели, для подобных повторяющихся игр с конечным числом шагов нет общей теории, из которой вытекало бы существование значения.
При анализе повторяющейся игры с вещественными ставками мы следуем схеме из~\cite{demeyer02c}.

Как и в главе~\ref{chapt1} множество возможных состояний рынка $S = \{H, L\}$, $s \in S$ при этом обозначает состояние, в котором на самом деле находится рынок.
На каждом шаге торгов, первый игрок делает ставку из множества $I = [0, 1]$, второй игрок "--- ставку из множества $J = [0,1]$.

Обозначим через $\Port{t} = (\Port{t}^R, \Port{t}^N)$ портфель первого игрока на $t$-м шаге торгов, где $\Port{t}^R$ и $\Port{t}^N$ "--- количество единиц рискового и безрискового активов соответственно.
Если на $t$-м шаге игроки делают ставки $i \in I,\ j \in J$, то портфель 
\[
\Port{t} = \Port{t-1} + t(i, j),
\]
где
\begin{equation}\label{ch2:eq:trans-mech}
  t(i, j) = \Ind_{i > j} (1, -(\Co i + \DCo j)) +
  \Ind_{i < j} (-1, \DCo i + \Co j).
\end{equation}
Таким образом, одна акция продается по цене, равной выпуклой комбинации предложенных ставок с заданным коэффициентом $\Co$.
Стоимость портфеля при этом равна
\begin{equation*}
  V(\Port{t})=\Ind_{s = H} \, \Port{t}^R + \Port{t}^N.
\end{equation*}
Цель игроков состоит в максимизации прибыли, полученной от торгов.

Как и в главе \ref{chapt1}, можно положить, что в начальный момент времени оба игрока имеют нулевые портфели.
При этом прибыль первого игрока после завершения сделок будет равна $V(\Port{n})$, а второго $-V(\Port{n})$.

\section{Формальная постановка задачи}
\label{ch2:sec:formal-descr}

Ниже мы рассмотрим теоретико-игровую постановку основной задачи и двойственной к ней в смысле Де~Мейера, которые мы будем называть прямой и двойственной играми соответственно.
Как отмечено в \cite{demeyer02}, прямая (двойственная) игра больше подходит для построения оптимальной стратегии первого (второго) игрока.

\subsection{Определение прямой игры $\mathbf{G^\Co_n(p)}$}
Прямая игра описывает взимодействие между агентами, соответствующее оригинальной модели биржевых торгов.
Так же перед началом игры ходом случая определяется $s \in S$ таким образом, что $P(s = H) = p, \; P(s = L) = 1-p$.
Выбранное $s$ сообщается первому игроку (инсайдеру), второй игрок при этом не осведомлен о настоящем значении $s$ и знает только вероятности выбора случаем того или иного состояния.

Стратегией игрока~1 является последовательность ходов $\sigma = (\sigma_1, \ldots, \sigma_n)$, где $\sigma_t = (\sigma^L_t,\ \sigma^H_t)$.
При фиксированном $s \in S$ ход $\sigma^s_t: H_{t-1} \rightarrow \Delta(I)$ является отображением из множества историй ставок к моменту времени $t$ в множество $\Delta(I)$ вероятностных распределений на $I$.
Обозначим множество стратегий первого игрока $\Sigma_n$.
Аналогично, стратегией второго игрока назовем последовательность ходов $\tau = (\tau_1, \ldots, \tau_n)$, где $\tau_t: H_{t-1} \rightarrow \Delta(I)$.
Обозначим множество стратегий второго игрока $\Tau_n$.

Пара стратегий $(\sigma, \tau)$ вместе с ходом случая индуцирует на $(S, H_n)$ вероятностное распределение $\Pi[p, \sigma, \tau]$.
Тогда выигрыш первого игрока равен
\[
  g^\Co_n(p, \sigma, \tau) = \E_{\Pi[p, \sigma, \tau]} V(\Port{n}).
\]
Выигрыш второго игрока при этом равен $-g^\Co_n(p, \sigma, \tau)$.

Полученную игру обозначим через $G^\Co_n(p)$. 
Ее нижнее и верхнее значения даются формулами
\begin{align*}
  V^\Co_{1,n}(p) = \sup_\sigma \inf_\tau g^\Co_n(p, \sigma, \tau), \quad
  V^\Co_{2,n}(p) = \inf_\tau \sup_\sigma g^\Co_n(p, \sigma, \tau).
\end{align*}
В том случае, когда $V^\Co_{1,n}(p) = V^\Co_{2,n}(p) = V^\Co_n(p)$, будем говорить, что игра имеет значение $V_n(p)$.
Стратегии $\sigma^*$ и $\tau^*$ называются оптимальными, если
\[
  \inf_\tau g^\Co_n(p, \sigma^*, \tau) = V^\Co_{1,n}(p), \enskip 
  \sup_\sigma g^\Co_n(p, \sigma, \tau^*) = V_{2,n}(p).
\]
В дальнейшем верхний индекс $\Co$ мы будем часто опускать.

В работе \cite{demeyer02} показано, что игра $G_n(p)$ имеет рекурсивную структуру аналогичную структуре повторяющейся игры из главы~\ref{chapt1}.
Соответственно, рассмотрим стратегию $\sigma$ первого игрока как пару $(\sigma_1, \tilde{\sigma})$, где $\sigma_1$ -- ход игрока на первом шаге игры, а $\tilde{\sigma}$ -- стратегия в игре продолжительности $n$, зависящая от ставок $(i, j)$ на первом шаге.
Аналогично стратегию $\tau$ второго игрока можно представить как пару $(\tau_1, \tilde{\tau})$.

Приведем несколько известных фактов, которые понадобятся нам в дальнейшем.

Пара $(\sigma_1, \tau_1)$ вместе с ходом случая индуцирует вероятностное распределение $\Pi[p, \sigma_1, \tau_1]$ на $(S, i, j)$.
Обозначим через
\[
  p(i, j) = \Pi[p, \sigma_1, \tau_1](s = H \;|\; i, j).
\]
апостериорную вероятность состояния $H$ при условии, что первый игрок сделал ставку $i$, а второй -- $j$.
Так как $j$ не зависит от $s$, то апостериорная вероятность
\[
  p(i, j) = p(i) = \Pi[p, \sigma_1](s = H \; | \; i)
\]
зависит только от $i$.
Тогда для значения выигрыша первого игрока справедливо представление
\begin{align*}
  g_{n+1}(p, \sigma, \tau) 
  &= 
    g_1(p, \sigma_1, \tau_1) +
    \E_{\Pi[p, \sigma_1, \tau_1]}
    g_n(p(i), \tilde{\sigma}(i, j), \tilde{\tau}(i, j)).
\end{align*}
Отсюда вытекает справедливость следующего утверждения для нижнего значения игры (\seename \cite{demeyer02}).
\begin{lemma}
  \label{ch2:lem:low-bound-primal}
  Для любого $p \in [0, 1]$ выполняется неравенство
  \begin{equation}
    V_{1,n+1}(p) \geqslant \sup_{\sigma_1} \inf_{j} g_1(p, \sigma_1, j)
    + \E_{\Pi[p, \sigma_1]} V_{1,n}\left( p(i) \right).
  \end{equation}
\end{lemma}
Подчеркнем, что поскольку можно положить $V_0(p) = 0$, данная формула имеет смысл для любого $n \geqslant 1$.

\subsection{Определение двойственной игры $\mathbf{G^*_n(x)}$}
Определим двойственную игру $G^*_n(x)$, следуя схеме из работы~\cite{demeyer02}.
Перед началом игры первый игрок выбирает текущее состояние $s \in S$; второй игрок не осведомлен о выборе первого.
Если $s = H$, то первый вынужден заплатить второму штраф размера $x$ в конце игры.
В остальном правила $G^*_n(x)$ аналогичны правилам $G_n(p)$.

Cтратегией первого игрока в двойственной игре является пара $\dualFPS$, где $p \in [0, 1]$, $\sigma \in \Sigma_n$.
Множество стратегий второго игрока совпадает с $\Tau_n$.

Выигрыш второго игрока, который он стремится максимизировать, определяется как
\begin{equation*}
  \dualg = x p - g_n(p, \sigma, \tau),
\end{equation*}
а верхнее и нижнее значения игры даются, соответственно, формулами
\begin{equation*}
  W_{1,n}(x) = \inf_{\dualFPS} \sup_\tau \dualg, \enskip
  W_{2,n}(x) = \sup_\tau \inf_{\dualFPS} \dualg.
\end{equation*}
В том случае, когда $W_{1,n}(x) = W_{2,n}(x) = W_n(x)$, будем говорить, что игра имеет значение $W_n(x)$.

Обозначим выигрыши в состояниях $H$ и $L$ через
\begin{equation*}
 g^H_1(\sigma_1, \tau_1) = g_1(1, \sigma_1, \tau_1), \enskip g^L_1(\sigma_1, \tau_1) = g_1(0, \sigma_1, \tau_1).
\end{equation*}
Аналогично предыдущему пункту, можно провести рассмотрение рекурсивной структуры игры $G^*_n(x)$ и получить следующий результат из \cite{demeyer02}.
\begin{lemma}\label{ch2:lem:low-bound-dual:general}
  Для любого $x \in \mathbb{R}$ выполняется неравенство
  \begin{equation}\label{ch2:eq:low-bound-dual:general}
    W_{2,n+1}(x) \geqslant \sup_{\tau_1} \inf_{i}
    W_{2,n}(x - g^H_1(i, \tau_1) + g_1^L(i, \tau_1)) - g^L_1(i, \tau_1).
  \end{equation}
\end{lemma}
Отметим, что так как $W^*_0(x) = \phi(x) = \min(x, 0)$, формула имеет смысл для любого $n \geqslant 1$.

\section{Решение одношаговой игры}
\label{ch2:sec:1st}

Получим решение одношаговой игры $G^\Co_1(p)$.
Для игры, соответствующей значению параметра $\Co = 1$, решение было получено в~\cite{sandomirskaya12}.
В силу того, что в состоянии $L$ использование ставки $0$, является доминирующей чистой стратегией, исходную игру удалось представить в виде игры с выбором момента времени, для которых известны эвристические методы решения (\seename \cite{karlin64}).
При $\Co \neq 1$ подобная чистая стратегия уже не является доминирующей, однако, как будет показано далее, при $p < \Co$ все равно является оптимальной для первого игрока.

Начнем рассмотрение со случая $p < \beta$.
Будем искать оптимальные стратегии игроков, удовлетворяющие следующим условиям.
Первый игрок в состоянии $L$ использует ставку $0$ с вероятностью 1.
Обозначим такое распределение через $I_0$.
В состоянии $H$ он рандомизирует действия в соответствии с вероятностным распределением $F$, имеющим плотность $f$, причем $F(d) = 1$ для некоторого $d \in [0, 1]$.

Второй игрок рандомизирует действия в соответствии с вероятностным распределением $G$, имеющим скачок величины $\delta$ в точке $0$ и плотность $g$ на $(0, \delta]$.
Обозначим такое распределение через $(\delta I_o, g)$.
Описанные стратегии имеют одинаковый спектр $[0, d]$.

Для первого игрока при заданном действии $y \in (0, d)$ второго получаем
\begin{equation}
  \label{ch2:eq:1st:g1(F,0)}
  \begin{gathered}
    g_1(p, (F, I_0), y) 
    = p g^H_1(p, F, y) + (1-p) g^L_1(p, I_0, y) = \\
    = p \left( 
      \int_0^y (\DCo x + \Co y - 1) f(x) \di x +
      \int_y^d (1 - \Co x - \DCo y) f(x) \di x
    \right) + (1-p) \Co y.
  \end{gathered}
\end{equation}
Отсюда имеем
\begin{align*}
  \frac{\partial g_1(p, (F, I_0), y)}{\partial y}
  &= p \left( 
    \int_0^y f(x) \di x - \DCo + 2(y-1)f(y)
  \right) +
  (1-p)\Co =\\
  &= p F(y) + 2p(y-1)F'(y) + \Co - p = 0.
\end{align*}
Решение данного уравнения представимо в виде
\begin{equation*}
  F(x) = \frac{C}{\sqrt{2(1-x)}} - \frac{\Co - p}{p},\ x \in [0, d].
\end{equation*}
Из условий $F(0) = 0,\ F(d) = 1$ находим $C = \sqrt{2}(\Co - p)/p,\ d = 1 - (\Co - p)^2/\Co^2$, откуда получаем
\begin{equation}
  \label{ch2:eq:1st:F}
  \begin{gathered}
    F(x) =
    \begin{cases}
      \frac{\Co - p}{p}(\frac{1}{\sqrt{1-x}} - 1),\ & x \leq 1 - \frac{(\Co - p)^2}{\Co^2},\\
      1,\ & \text{иначе},
    \end{cases}\\
    f(x) =
    \begin{cases}
      \frac{\Co - p}{2 p} \frac{1}{(1-x)^{3/2}},\ & x \leq 1 - \frac{(\Co - p)^2}{\Co^2},\\
      0,\ & \text{иначе}.
    \end{cases}
  \end{gathered}
\end{equation}
\begin{lemma}
  \label{ch2:lem:1st:lower-bound}
  При заданных $p$ и $\Co$ таких, что $p < \Co$, стратегия первого игрока $(\sigma^H, \sigma^L) = (F, I_0)$ гарантирует ему выигрыш не менее $p(1-p)$ в игре $G^\Co_1(p)$.
\end{lemma}
\begin{proof}
  При $y \in (0, d)$ получим выигрыш, подставив \eqref{ch2:eq:1st:F} в \eqref{ch2:eq:1st:g1(F,0)}. Для $g^H_1(p, (F, I_0), y)$ имеем
  \begin{equation*}
    \begin{gathered}
    g^H_1(p, (F, I_0), y) 
    =
    \int_0^y (\DCo x + \Co y - 1) f(x) \di x +
    \int_y^d (1 - \Co x - \DCo y) f(x) \di x = \\
    =
    - \int_0^d \Co x f(x) \di x +
    \int_0^d \Co y f(x) \di x -
    \int_0^y (1-x) f(x) \di x + \\
    + \int_y^d (1-y) f(x) \di x
    \end{gathered}
  \end{equation*}
  Находим
  \begin{equation}
    \label{ch2:eq:1st:f-exp}
    \begin{aligned}
      \int_0^d x f(x) \di x 
      &= \frac{\Co - p}{2 p} \int_0^d x \frac{1}{(1-x)^{3/2}} \di x = \\
      &= \frac{\Co - p}{2 p} \left( 
        2x \frac{1}{\sqrt{1-x}} \bigg|_0^d +
        4 \sqrt{1-x} \bigg|_0^d
      \right) = \\
      &= \frac{\Co - p}{p} \cdot \frac{2 - d - 2\sqrt{1-d}}{\sqrt{1-d}} =
      \frac{\Co - p}{p} \cdot \frac{p^2}{(\Co - p) \Co} = \frac{p}{\Co}.
    \end{aligned}
  \end{equation}
  Отсюда имеем
  \begin{gather*}
    g^H_1(p, (F, I_0), y) 
    = -p + \Co y +
    \frac{\Co - p}{p} \left( \sqrt{1-y} - 1 \right) +
    (1-y) \times \\
    \times \left( 1 - \frac{\Co - p}{p} \left( \frac{1}{\sqrt{1-y}} - 1 \right) \right) =
    -p + \Co y - \frac{\Co - p}{p} + (1-y) \left( 1 + \frac{\Co - p}{p} \right) = \\
    = \frac{(1-p)(p - \Co y)}{p}.
  \end{gather*}
  Подставив данное выражение в \eqref{ch2:eq:1st:g1(F,0)} находим $g_1(p, (F, I_o), y) = p (1-p)$.

  При $y \in \{0, d\}$ выигрыш равен
  \begin{align*}
    g_1(p, (F, I_0), 0) 
    &= p \left(\int_0^d f(x) \di x - \Co \int_0^d x f(x) \di x \right) =
      p(1-p),\\
    g_1(p, (F, I_0), d) 
    &=
      p \int_0^d (\DCo x + \Co d - 1) f(x) \di x + (1-p) \Co d = \\
    &= p \frac{(1-p)(p-\Co)}{\Co} +
      (1-p) \Co \left( 1 - \frac{(\Co - p)^2}{\Co^2} \right) = p(1-p).
  \end{align*}
  Также несложно показать, что при $y > d$ справедливо неравенство $g_1(p, (F, 0), y) > g_1(p, (F, 0), d)$.
  Таким образом $V_{1,1}(p) \geq p(1-p)$.
\end{proof}


Стратегию второго игрока будем искать из условия выравнивания выигрыша первого при применении им действия $(x^H, 0),\ x^H \in (0, d)$.
Выигрыш дается формулой
\begin{align*}
  g_1(p, (x^H, 0), G) 
  &= p \left(
    \int_0^{x^H} (1 - \Co x^H  - \DCo y) G(\di y) + \int_{x^H}^d (\DCo x + \Co y - 1) G(\di y)
    \right) + \\
  &+ (1-p) \int_0^d \Co y g(y) \di y.
\end{align*}
Отсюда получаем
\begin{align*}
  \frac{\partial g_1(p, (x^H, 0), G)}{\partial x^H} 
  &= -\int_0^x G(\di y) + 2(1-x) g(x) + \DCo \int_0^d G(\di y) = \\
  &= -G(x) + 2(1-x)G'(x) + \DCo =
  0.
\end{align*}
Решение данного дифференциального уравнения имеет вид 
\begin{equation*}
  G(y) = \frac{C}{\sqrt{2}\sqrt{1-x}} + \DCo.
\end{equation*}
Из условия $G(d) = 1$ находим $C = \sqrt{2}(\Co - p)$, откуда вытекает
\begin{equation}
  \label{ch2:eq:1st:G}
  \begin{gathered}
    G(y) =
    \begin{cases}
      \frac{\Co - p}{\sqrt{1-y}} + \DCo,\ & y \leq 1 - \frac{(\Co - p)^2}{\Co^2},\\
      1,\ & \text{иначе},
    \end{cases}\\
    g(y) =
    \begin{cases}
      \frac{\Co - p}{2(1-y)^{3/2}},\ & y \leq 1 - \frac{(\Co - p)^2}{\Co^2},\\
      0,\ & \text{иначе},
    \end{cases}
  \end{gathered}
\end{equation}
Величина скачка в точке $0$ равна $\delta = G(0) = 1 - p$.

\begin{lemma}
  \label{ch2:lem:1st:upper-bound}
  При заданных $p$ и $\Co$ таких, что $p < \Co$, стратегия второго игрока $G$ гарантирует ему проигрыш не более $p(1-p)$ в игре $G^\Co_1(p)$.
\end{lemma}
\begin{proof}
  Аналогично \eqref{ch2:eq:1st:f-exp} устанавливается справедливость равенства $\int_0^d y g(y) = p^2/\Co$.
  Покажем, что $g^L_1(p, x^L, G) < g^L_1(p, 0, G),\ x^L \in (0, 1]$.
  В случае $x^L \in (0, d]$ получаем
  \begin{align*}
    g^L_1(p, x^L, G)
    &= \int_0^{x^L} (-\Co x^L - \DCo y) G(\di y) + \int_{x^L}^d(\DCo x^L + \Co y) G(\di y) = \\
    &= - \Co x^L - \int_0^{x^L} y g(y) \di y + \int_{x^L}^d x^L g(y) \di y + \Co \int_0^d y g(y) \di y = \\
    &= - \frac{\Co x^L}{p} \int_0^d g(y) - \int_0^{x^L} y g(y) \di y + \int_{x^L}^d x^L g(y) \di y + g^L_1(p, 0, G) < \\
    &< -\int_0^d x^L g(y) \di y + \int_{x^L}^d x^L g(y) \di y - \int_0^{x^L} y g(y) \di y + g^L_1(p, 0, G) = \\
    &= - \int_0^{x^L} (x^L - y) g(y) \di y + g^L_1(p, 0, G) \leq g^L_1(p, 0, G).
  \end{align*}
  При $x^L \in (d, 1]$ соответствующее неравенство доказывается аналогично.
  Таким образом, использование первым игроков стратегии $I_0$ в состоянии $L$ является наилучшим ответом на стратегию $G$ второго игрока.
  Максимальный проигрыш в состоянии $L$ второго игрока равен $g^L_1(p, 0, G) = p^2$.
  
  Найдем выигрыш в состоянии $H$, подставив (\ref{ch2:eq:1st:G}) в (\ref{ch2:eq:1st:g1(F,0)}).
  При $x^H \in (0, d)$ имеем
  \begin{multline*}
    g^H_1(p, x^H, G) = (1 - p)(1 - x\Co) + \int_0^x (1 - \Co x - \DCo y) g(y) \di y + \int_x^d (\DCo x + \Co y - 1) g(y) \di y. 
  \end{multline*}
  Обозначим сумму интегралов выше через $(I)$ и найдем ее
  \begin{align*}
    (I)
    &= \int_0^x (1-y) g(y) \di y - \int_x^d (1-x) g(y) \di y + \Co \int_0^d y g(y) \di y - \Co \int_0^d x g(y) \di y = \\
    &= (\Co - p)\left(-\sqrt{1-y}\bigg|_0^x\right) - (1 - x)(G(d) - G(x)) + p(p - x\Co) = \\
    &= (\Co - p)(1 - \sqrt{1-x}) + (\Co - p)\sqrt{1-x} - \Co (1 - x) + p(p - x\Co) = \\
    &= (1 - p)(x\Co - p).
  \end{align*}
  Отсюда
  \begin{equation*}
    g^H_1(p, x^H, G) = (1 - p)(1 - x\Co) + (I) = (1 - p)(1 - x\Co) + (1 - p)(x\Co - p) = (1 - p)^2.
  \end{equation*}
  Таким образом, выигрыш при $x \in (0, d)$ равен
  \begin{equation*}
    g_1(p, (x^H, 0), G) = p (1 - p)^2 + (1 - p) p^2 = p (1 - p).
  \end{equation*}
  Также несложно показать, что 
  \begin{gather*}
    g^H_1(p, 0, G) = 0,\enskip
    g^H_1(p, d, G) = (1 - p)^2, \\
    g^H_1(p, x^H, G) < g^H_1(p, d, G),\ x \in (d, 1].
  \end{gather*}
  Отсюда получаем, что $V_{2,1} \leq p(1-p)$.
\end{proof}

Из лемм \ref{ch2:lem:1st:lower-bound} и \ref{ch2:lem:1st:upper-bound} следует, что при $p < \Co$ оптимальные стратегии определяются формулами (\ref{ch2:eq:1st:F},~\ref{ch2:eq:1st:G}), а значение игры равно $V_1(p) = p(1-p)$.

Так как для произвольных $x^H, x^L, y$ из отрезка $[0, 1]$ справедливо равенство
\[
  g^\Co_1(p, (x^H, x^L), y) = g^{1-\Co}_1(1 - p, (1 - x^L, 1 - x^H), 1 - y),
\]
то решение одношаговой игры с параметрами $(p, \Co)$ сводится к решению одношаговой игры с параметрами $(1 - p, 1 - \Co)$.

Кроме того, несложно показать, что при $p = \Co$ стратегия первого игрока $(\sigma^H,\ \sigma^L) = (I_1,\ I_0)$ и стратегия второго игрока $\tau = \left( (1-p) I_0,\ p I_1 \right)$ являются оптимальными, а значение игры также равно $p(1-p)$.

Таким образом, уже на примере одношаговой игры можно наблюдать тот эффект, что значение игры на зависит от параметра $\Co$.


\section{Оценки выигрыша в $\mathbf{n}$-шаговой игре}
\label{ch2:sec:value-bounds}

В данном разделе будут построены выравнивающие стратегии первого и второго игроков в прямой и двойственной играх, соответственно.
Будет показано, что несмотря на то, что по виду данные стратегии отличается от стратегий из \cite{demeyer02}, вид оценок на $V_{1,n}(p)$ и $W_{2,n}(x)$ остается неизменным.
Отсюда будет следовать справедливость двойственных соотношений между $V_{1,n}(p)$ и $W_{2,n}(x)$, существование $V_n(p)$ и $W_n(x)$, формулы для их расчета, а также оптимальность построенных стратегий.

Нам потребуются некоторые определения и факты из выпуклого анализа.

Пусть $f$ "--- вогнутая функция, определенная на прямой, причем $f$ может принимать значение $-\infty$.
Функцией, сопряженной к $f$ в смысле Фенхеля, называется
\begin{equation*}
  f^*(x^*) = \inf \{ x^* \cdot x - f(x) \;|\; x \in \mathbb{R} \}.
\end{equation*}
Эффективное множество функции $f$ определяется следующим образом:
\[
\dom f = \{ x \;|\; f(x) > -\infty \}.
\]
Множество значений функции $f$ будем обозначать \[
\range f = \{ f(x) \;|\; x \in \mathbb{R} \}.
\]
%
Субдифференциалом функции $f$ в точке $x$ называется множество
\begin{equation*}
  \partial f(x) =
  \{ a \in \mathbb{R} \;|\; \forall y \in \mathbb{R}: f(y) \leqslant f(x) + a(y-x) \}.
\end{equation*}
%
Справедливо утверждение \cite[Теорема 23.5]{rockafellar73}:
\begin{equation}\label{ch2:eq:subdiff-props}
  x^* \in \partial f(x) \iff x \in \partial f^*(x^*).
\end{equation}
Кроме того, имеют место следующие включения \cite[\S~24]{rockafellar73}:
\begin{equation}\label{ch2:eq:dual-range}
  \mathrm{int} \; (\dom f) \subset \range \partial f^* \subset \dom f.
\end{equation}

В \cite{demeyer02} показано, что $V_{1,n}(\cdot)$ и $W_{2,n}(\cdot)$ являются вогнутыми на своей области определения.
Предположим дополнительно, что функции $V_{1,n}(\cdot)$, $V^*_{1,n}(\cdot)$ и $W_{2,n}(\cdot)$ непрерывно дифференцируемы.
Справедливость данных предположений будет обоснована в разделе~\ref{ch2:sec:game-value}.


\subsection{Оценка нижнего значения $\mathbf{V_{1,n}(p)}$ игры $\mathbf{G_n(p)}$}
\label{ch2:sec:-primal-game}

В \cite{demeyer02} рассматривается параметризация одношаговой стратегии инсайдера функциями $f$ и $Q$, которые используются для генерации маргинального распределения ставки $i$ и апостериорной вероятности $p(i)$ соответственно.
Далее мы покажем, что задание стратегии первого игрока при помощи пары $(f, Q)$ в некотором смысле естественно и приведем способ перехода от параметризованного представления к стратегии $\sigma_1$.

Обозначим через $\sigma^M_1(i) = p \sigma^H_1(i) + (1-p) \sigma^L(i)$ маргинальное распределение ставки $i$.

\begin{proposition}
  Для апостериорной вероятности $p(i)$ состояния $H$ справедлива формула
  \begin{equation}\label{ch2:eq:p(i)}
    p(i) = p \; \frac{\di \sigma^H_1}{\di \sigma^M_1}(i),
  \end{equation}
  где $\di \sigma^H_1/\di \sigma^M_1$ -- производная Радона-Никодима.
\end{proposition}
\begin{proof}
  По определению $p(i)$ для любого множества $B$ из борелевской $\sigma$-алгебры $\Borel(I)$ отрезка $I$ выполнено
  \begin{equation*}
    P(s = H, \; i \in B) = \int_B p(i) \; \sigma^M_1(\di i).
  \end{equation*}
  С другой стороны, справедлива следующая формула:
  \begin{equation*}
    P(s = H, \; i \in B) = p \int_B \sigma^H_1(\di i).
  \end{equation*}
  Так как $\sigma^H_1$ абсолютно непрерывна относительно $\sigma^M_1$, то существует производная Радона-Никодима, а значит
  \begin{equation*}
    P(s = H, \; i \in B) =
    \int_B p \frac{\di \sigma^H_1}{\di \sigma^M_1}(i) \; \sigma^M_1(\di i).
  \end{equation*}
  Отсюда получаем \eqref{ch2:eq:p(i)}.
\end{proof}

\begin{proposition}
  Для $g_1(p, \sigma_1, j)$ справедливо представление
  \begin{equation}\label{ch2:eq:g1-aposterior}
    \begin{multlined}
      g_1(p, \sigma_1, j) = \int_I \Ind_{i > j} \biggl[ p(i) - \Co i -
      \DCo j
      \biggr] \; \sigma^M_1(\di i) \; + \\
      + \int_I \Ind_{i < j} \biggl[ \DCo i + \Co j - p(i) \biggr] \;
      \sigma^M_1(\di i).
    \end{multlined}
  \end{equation}
\end{proposition}
\begin{proof}
  По определению
  \begin{equation}\label{ch2:eq:g1-def}
    g_1(p, \sigma_1, j) = \E_{\Pi[p, \sigma_1]} \langle
    (\Ind_{s = H}, 1), t(i, j)
    \rangle.
  \end{equation}
  Подставив~\eqref{ch2:eq:trans-mech} в~\eqref{ch2:eq:g1-def}, получим
  \begin{multline*}
    g_1(p, \sigma_1, j) = 
    p \int_I \biggl[ \Ind_{i > j}(1 - \Co i - \DCo j) + \Ind_{i < j} \times \\
    \times (\DCo i - \Co j - 1) \biggr] \; \sigma^H_1(\di i) +
    (1-p) \int_I \biggl[
      \Ind_{i > j} \times \\
      \times (- \Co i - \DCo j) + \Ind_{i < j}(\DCo i - \Co j) 
    \biggr]
    \; \sigma^L_1(\di i).
  \end{multline*}
  Отсюда, воспользовавшись~\eqref{ch2:eq:p(i)}, получим~\eqref{ch2:eq:g1-aposterior}.
\end{proof}

Формула \eqref{ch2:eq:g1-aposterior} показывает альтернативное представление стратегии инсайдера $\sigma_1$ с помощью маргинального распределения ставки и апостериорной вероятности состояния $H$.
Укажем способ перехода от $\sigma_1$ к параметризованному представлению $(f, Q)$ и наоборот.

Возьмем случайную величину $u$, равномерно распределенную на $[0, 1]$.
Если $f(\cdot)$ -- левая обратная функции распределения $i$, то $f(u)$ и $i$ одинаково распределены.
Обозначим $Q(u) = p(f(u))$.
Пусть также $\pi = \Pi[p, \sigma_1]$.
Так как для любого $B \in \Borel(I)$ выполнено
\begin{equation*}
  \pi(i \in B \; | \; s = H) =
  \frac{\pi(i \in B, \; s = H)}{\pi(s = H)} =
  \int_0^1 \Ind_{f(u) \in B} \frac{Q(u)}{p} \di u,
\end{equation*}
то восстановить $\sigma_1$ по $(f, Q)$ можно следующим образом.
Если ходом случая было выбрано состояние $H$, то инсайдер выбирает $u \in [0, 1]$ с плотностью вероятности $Q(u)/p$ и делает ставку $i = f(u)$.
Аналогично, в состоянии $L$ он выбирает $u$ с плотностью вероятности $(1 - Q(u))/(1 - p)$ и делает ставку $i = f(u)$.

Введем обозначение
\[
  \Ff{j} = g_1(p, (f, Q), j) + \E V_{1,n}(Q(u)).
\]
Переходя к $f$ и $Q$ в формуле~\eqref{ch2:eq:g1-aposterior} получаем следующее равенство:
\begin{equation}\label{ch2:eq:F(f,Q,p)}
\begin{multlined}
  \Ff{j} =
  \int_0^1 \Ind_{f(u) > j} (Q(u) - \Co f(u) - \DCo j) \di u \enskip + \\
  + \int_0^1 \Ind_{f(u) < j} (\DCo f(u) + \Co j - Q(u)) \di u \; + \int_0^1
  V_{1,n}(Q(u)) \di u.
\end{multlined}
\end{equation}

Как показано в \cite{demeyer02}, чтобы быть параметризацией некоторой одношаговой стратегии $\sigma_1$ первого игрока в игре $G_n(p)$, функции $f$ и $Q$ должны удовлетворять следующим свойствам:
\begin{subequations}
  \begin{flalign}
    \label{ch2:eq:parametr-prop:f-incr}
    &\bullet\quad \forall u_1, u_2 \in [0, 1]: u_1 < u_2 \implies f(u_1) \leq f(u_2),&\\
    \label{ch2:eq:parametr-prop:int-q=p}
    &\bullet\quad \int_0^1 Q(u) \di u = p,&\\
    \label{ch2:eq:parametr-prop:f-Q-eq}
    &\bullet\quad \forall u_1, u_2 \in [0, 1]: f(u_1) = f(u_2) \implies Q(u_1) = Q(u_2).&
  \end{flalign}
\end{subequations}
Условия (\ref{ch2:eq:parametr-prop:f-incr},~\ref{ch2:eq:parametr-prop:int-q=p}) естественны, условие \eqref{ch2:eq:parametr-prop:f-Q-eq} необходимо для того, чтобы случайная величина $Q(u)$ была измеримой относительно $\sigma$-алгебры порожденной $i$.
Переформулируем лемму~\ref{ch2:lem:low-bound-primal} в терминах $f$ и $Q$.
\begin{lemma}
  Для любого $p \in [0, 1]$ выполняется неравенство
  \[
    V_{1,n+1}(p) \geqslant \sup_{(f, \; Q)} \inf_{j} \Ff{j},
  \]
  где $f$ и $Q$ удовлетворяют~\eqref{ch2:eq:parametr-prop:f-incr} "--- \eqref{ch2:eq:parametr-prop:f-Q-eq}.
\end{lemma}

Будем искать пару $(f, Q)$, выравнивающую выигрыш первого игрока при $j \in [f(0), f(1)]$.
Пусть $j = f(\alpha)$ для некоторого $\alpha \in [0, 1]$, и $f$ возрастает в некоторой окрестности точки $\alpha$.
Тогда для выравнивающей пары $(f, Q)$ выражение
\begin{multline}\label{ch2:eq:F(f,Q,fa)}
  \Ff{f(\alpha)} = \int_\alpha^1 \left( Q(u) - \Co f(u) - \DCo f(\alpha)
  \right) \di u \; + \\
  + \int_0^\alpha \left( \DCo f(u) + \Co f(\alpha) - Q(u) \right) \di u +
  \int_0^1 V_{1,n}(Q(u)) \di u,
\end{multline}
не зависит от $\alpha$. Следовательно,
\begin{align*}
  \frac{\partial F_{n+1}}{\partial \alpha}
  = (\alpha - \DCo) f'(\alpha) + 2 f(\alpha) - 2 Q(\alpha)
  = 0.
\end{align*}
Отсюда
\begin{equation}
  \label{ch2:eq:f}
  f(u) = (u - \DCo)^{-2} \int_{\DCo}^u 2(x-\DCo) Q(x) \di x.\footnotemark
  \footnotetext{
    При $u = \DCo$ доопределим $f(\DCo)$ по непрерывности как $Q(\DCo)$.
  }
\end{equation}%

Если подставить \eqref{ch2:eq:f} в \eqref{ch2:eq:F(f,Q,fa)}, то получившееся выражение $\Phi(Q)$ зависит только от $Q$ и не зависит от $\alpha$.
При $\alpha = 1$ получим
\begin{equation}\label{ch2:eq:Phi:raw}
  \begin{gathered}
    \Phi(Q) = \int_0^1 (\DCo f(u) - Q(u)) \di u + \Co f(1) + \int_0^1
    V_{1,n}(Q(u)) \di u.
  \end{gathered}
\end{equation}

\begin{lemma}\label{ch2:lem:Phi}
  Для $\Phi(Q)$ справедливо следующее выражение:
  \begin{equation}\label{ch2:eq:Phi(Q)}
    \Phi(Q) = \int_0^1 (2u - 1) Q(u) \di u + \int_0^1 V_{1,n}(Q(u)) \di u.
  \end{equation}
\end{lemma}
\begin{proof}
  Упростим \eqref{ch2:eq:Phi:raw} при $\Co \in (0, 1)$. Случаи $\Co = 0$ и $\Co = 1$ дают тот же результат и рассматриваются аналогично.

  Найдем выражение для $\int_0^1 f(u) \di u$, разбив этот интеграл на две части.
  Для первой части имеем:
  \begin{multline*}
    \int_0^\DCo f(u) \di u = \int_0^\DCo (u - \DCo)^{-2} \int_\DCo^u 2(s - \DCo) Q(s) \di s = \\
    = \int_0^\DCo 2 (\DCo - s) Q(s) \int_0^s (\DCo - u)^{-2} \di u \di s =
    (2/\DCo) \int_0^\DCo u Q(u) \di u.
  \end{multline*}
  Аналогично для второй части получим
  \begin{gather*}
    \int_\DCo^1 f(u) \di u = (2/\Co) \int_\DCo^1 (1-u) Q(u) \di u.
  \end{gather*}
  Подставим найденные выражения в~\eqref{ch2:eq:Phi:raw}:
  \begin{multline*}
    \Phi(Q) = 2 \int_0^\DCo u Q(u) \di u + (2\DCo/\Co) \int_\DCo^1 (1-u) Q(u) \di u \; + \\
    + (2/\Co) \int_\DCo^1 (u - \DCo) Q(u) \di u - \int_0^1 Q(u) \di u + \int_0^1
    V_{1,n}(Q(u)) \di u.
  \end{multline*}
  %
  Приведя подобные с учетом равенства $\DCo (1-u) + u - \DCo = \Co u$, получим
  \eqref{ch2:eq:Phi(Q)}.
\end{proof}

Найдем $Q$ как экстремаль следующей вариационной задачи:
\begin{align}
  \label{ch2:eq:Q-Problem}
  \Phi(Q) \rightarrow \max, \quad
  \int_0^1 Q(u) \di u = p.
\end{align}

По предположению $V_{1,n}(\cdot)$ -- непрерывно дифференцируемая функция.
Тогда функция $Q$, доставляющая экстремум в задаче \eqref{ch2:eq:Q-Problem}, удовлетворяет уравнению Эйлера со следующим функционалом (\seename \cite{elsgolc69}):
\begin{equation*}
  \Phi^*(Q) =
  \int_0^1 \left[
     (2u - 1) Q(u) + V_{1,n}'(Q(u)) + \lambda Q(u)
   \right] \di u =
  \int_0^1 F^* \di u.
\end{equation*}
В силу того, что $\Phi^*$ не зависит от $Q'$, имеем
\begin{gather*}
  \frac{\di F^*}{\di Q} = 2u - 1 - \lambda + V_{1,n}'(Q(U)) = 0,\\
  \int_0^1 Q(u) \di u = p.
\end{gather*}
Воспользовавшись свойством \eqref{ch2:eq:subdiff-props} о связи между субдифференциалами сопряженных функций, получим
\begin{align}
  \label{ch2:eq:Q(u)}
  &Q(u) = V^{*\prime}_{1,n}(1+\lambda-2u),\\
  %
  \label{ch2:eq:lambda-cond}
  &\int_0^1 V^{*\prime}_{1,n}(1+\lambda-2u) \di u = p.
\end{align}

Так как $V_{1,n}(\cdot)$ определена на $[0, 1]$, то из~\eqref{ch2:eq:dual-range} следует, что
\begin{equation*}
  \mathrm{int} \left( \dom V_{1,n}(\cdot) \right)
  = (0, 1)
  \subset \range \partial V_{1,n}^*(\cdot),
\end{equation*}
и $V^{*\prime}_{1,n}(\cdot)$ не возрастает на $\mathbb{R}$ от $1$ до $0$.
Поэтому $\lambda$, удовлетворяющее~\eqref{ch2:eq:lambda-cond}, существует.

Введем обозначение
\begin{equation*}
  K(\lambda) = \int_0^1 V^*_{1,n}(1+\lambda-2u) \di u.
\end{equation*}
Тогда аналогично \cite{demeyer02} можно показать, что при подстановке~\eqref{ch2:eq:Q(u)} в~\eqref{ch2:eq:Phi(Q)} выполняется равенство
\begin{equation}\label{ch2:eq:phi=k*}
  \Phi(Q) = K^*(p).
\end{equation}

Отметим, что хотя функция $f(u)$ зависит от коэффициента $\Co$, выражения для функций $Q(u)$ и $\Phi(Q)$ от него не зависят и по форме совпадают с аналогичными выражениями в \cite{demeyer02}.
Данный факт позволит нам без изменений использовать соотношения из \cite{demeyer02} между нижними значениями прямой и двойственной игр.
Но прежде нужно показать, что полученные $f$ и $Q$ удовлетворяют условиям~\eqref{ch2:eq:parametr-prop:f-incr} "--- \eqref{ch2:eq:parametr-prop:f-Q-eq} и доставляют гарантированный выигрыш первого игрока, равный $K^*(p)$.

\begin{lemma}
  \label{ch2:lem:f-Q-is-strategy}
  Функции $f$ и $Q$\textnormal{,} определенные в~\eqref{ch2:eq:f} и \eqref{ch2:eq:Q(u)}\textnormal{,} принимают значения в $[0, 1]$ и удовлетворяет~\eqref{ch2:eq:parametr-prop:f-incr} "--- \eqref{ch2:eq:parametr-prop:f-Q-eq}\textnormal{,} т.е. параметризуют некоторую стратегию $\sigma_1$ первого игрока.
\end{lemma}
\begin{proof}
  Так как $V^{*\prime}_{1,n}(\cdot)$ не возрастает от $1$ до $0$, то $Q(\cdot)$ принимает значения в $[0, 1]$ и в силу \eqref{ch2:eq:Q(u)} не убывает на $[0, 1]$.

  Далее, из \eqref{ch2:eq:f} вытекает, что $f(u)$ является математическим ожиданием $Q(X)$, где $X$ -- случайная величина, распределенная на отрезке $[\DCo, u]$ ($[u, \DCo]$) при $\DCo < u$ ($u < \DCo$) с плотностью $2|x-\DCo|/(u-\DCo)^2$.
  Следовательно, $f(\cdot)$ также принимает значения в $[0, 1]$.

  Сделаем замену переменной $t = (x - \DCo)/(u - \DCo)$ в \eqref{ch2:eq:f}. Тогда
  \begin{equation*}
    f(u) = \int_0^1 2 t Q \left( t(u - \DCo) + \DCo \right) \di t.
  \end{equation*}
  Отсюда видно, что~\eqref{ch2:eq:parametr-prop:f-incr} выполнено. Далее, \eqref{ch2:eq:parametr-prop:int-q=p} выполнено по построению.
  Чтобы доказать \eqref{ch2:eq:parametr-prop:f-Q-eq}, рассмотрим несколько случаев.

  Пусть $\DCo < u_1 < u_2$ и $f(u_1) = f(u_2)$.
  Тогда, так как $Q$ не убывает, почти при всех $t \in [0, 1]$ выполнено $ Q(t(u_1 - \DCo) + \DCo) = Q(t(u_2 - \DCo) + \DCo)$.
  Из непрерывности $Q$ следует равенство при $t = 1$, т.е. $Q(u_1) = Q(u_2)$.

  При $\DCo = u_1 < u_2$ имеем $f(u_1) = f(\DCo) = Q(\DCo)$.
  Отсюда почти при всех $t \in [0, 1]$ выполнено $Q(t(u_2 - \DCo) + \DCo) = Q(\DCo)$.
  Снова из непрерывности $Q$ получаем $Q(u_1) = Q(u_2) = Q(\DCo)$.

  Доказательство при $u_1 < u_2 \leqslant \DCo$ и $u_1 < \DCo < u_2$ проводится аналогично.
  Таким образом, \eqref{ch2:eq:parametr-prop:f-Q-eq} выполнено.
\end{proof}

\begin{lemma}
  \label{ch2:lem:f=Q}
  Если $f(u_1) = f(u_2)$ при $u_1 < u_2$, то $f(u) = Q(u)$ при $u \in [u_1, u_2]$.
\end{lemma}
\begin{proof}
  Действительно, если $f(u_1) = f(u_2)$, то из леммы~\ref{ch2:lem:f-Q-is-strategy} следует, что $f(\cdot)$ и $Q(\cdot)$ постоянны на $[u_1, u_2]$.
  Тогда из \eqref{ch2:eq:f} имеем
  \begin{align*}
    f(u_2)
    &= (u_2 - \DCo)^{-2} \int_\DCo^{u_2} 2 (x - \DCo) Q(x) \di x = \\
    &= (u_2 - \DCo)^{-2} \left(
      \int_\DCo^{u_1} 2 (x - \DCo) Q(x) \di x \, +
      \int_{u_1}^{u_2} 2 (x - \DCo) Q(x) \di x
      \right) = \\
    &= (u_2 - \DCo)^{-2} \left(
      (u_1 - \DCo)^2 f(u_1) +
      \int_{u_1}^{u_2} 2 (x - \DCo) Q(u_1) \di x
      \right) = \\
    &= (u_2 - \DCo)^{-2} \left(
      (u_1 - \DCo)^2 f(u_1) +
      \left( (u_2 - \DCo)^2 - (u_1 - \DCo)^2 \right) Q(u_1)
      \right).
  \end{align*}
  С другой стороны, для $f(u_1)$ справедливо
  \begin{equation*}
    f(u_1) = (u_2 - \DCo)^{-2} \left(
      (u_1 - \DCo)^2 f(u_1) +
      \left( (u_2 - \DCo)^2 - (u_1 - \DCo)^2 \right) f(u_1)
    \right).
  \end{equation*}
  Таким образом, $f(u_1) = Q(u_1)$, а следовательно $f(u) = Q(u)$ при $u \in [u_1, u_2]$.
\end{proof}

\begin{theorem}\label{ch2:thm:V-bound}
  При любом $p \in [0, 1]$ для гарантированного выигрыша первого игрока в игре $G_n(p)$ справедлива оценка $V_{1,n+1}(p) \geqslant K^*(p)$.
\end{theorem}
\begin{proof}
  В силу леммы~\ref{ch2:lem:low-bound-primal} достаточно доказать, что при любом $j \in [0, 1]$ выполнено $\Ff{j} \geqslant K^*(p)$.
  Рассмотрим несколько случаев.

  Пусть $j < f(0)$.
  Тогда из~\eqref{ch2:eq:F(f,Q,p)} и~\eqref{ch2:eq:phi=k*} получаем неравенство
  \begin{multline*}
    \Ff{j} = \int_0^1 \left[ Q(u) - \Co f(u) - \DCo j
    \right] \di u \; + \\
    + \int_0^1 V_{1,n}(Q(u)) \di u \geqslant \Ff{f(0)} = \Phi(Q) = K^*(p).
  \end{multline*}
  Аналогично можно показать, что при $j > f(1)$
  \begin{equation*}
    \Ff{j} \geqslant \Ff{f(1)} = \Phi(Q) = K^*(p).
  \end{equation*}
  Пусть теперь $j = f(\alpha), \; \alpha \in [0, 1]$. Введем обозначения
  \[
    \alpha^- = \inf \left\{ x \;|\; f(x) = f(\alpha) \right\}, \quad \alpha^+ =
    \sup \left\{ x \;|\; f(x) = f(\alpha) \right\}.
  \]
  Подстановкой в~\eqref{ch2:eq:F(f,Q,p)} получаем
  \begin{multline}\label{ch2:eq:V-lower:alpha-0-1}
    \Ff{j} =
    \int_{\alpha^+}^1  (Q(u) - \Co f(u) - \DCo f(\alpha)) \di u \; + \\
    + \int_0^{\alpha^-} (\DCo f(u) + \Co f(\alpha) - Q(u)) \di u \; + \int_0^1
    V_{1,n}(Q(u)) \di u.
  \end{multline}
  Однако, из леммы~\ref{ch2:lem:f=Q} следует, что $Q(u) = f(\alpha)$ при $u \in [\alpha^-, \alpha^+]$.
  Поэтому~\eqref{ch2:eq:V-lower:alpha-0-1} совпадает с~\eqref{ch2:eq:F(f,Q,fa)} и $\Ff{j} = \Phi(Q) = K^*(p)$ по построению.
\end{proof}

\subsection{Оценка нижнего значения $\mathbf{W_{2,n}(x)}$ игры $\mathbf{G^*_n(x)}$}
\label{ch2:sec:-dual-game}

Аналогично тому, как это было сделано для первого игрока, параметризуем $\tau_1$ при помощи неубывающей функции $h: [0, 1] \rightarrow [0, 1]$.
Если случайная величина $u$ равномерно распределена на $[0, 1]$, положим $j = h(u)$.
Таким образом может быть получено любое распределение $\tau_1$ для $j$.

Подобно предыдущему разделу получим аналог леммы~\ref{ch2:lem:low-bound-dual:general} в терминах $h$.
Заметим, что для $g_1^L(i, \tau_1)$ и $g_1^H(i, \tau_1)$ справедливы равенства
\begin{align*}
  g_1^L(i,\tau_1) &=
                      \int_J \biggl[
                      \Ind_{i>j} (-\Co i - \DCo j) +
                      \Ind_{i<j} (\DCo i + \Co j)
                      \biggr] \tau_1(\di j),\\
  g_1^H(i,\tau_1) &=
                      \int_J \biggl[
                      \Ind_{i>j} (1 -\Co i - \DCo j) +
                      \Ind_{i<j} (\DCo i + \Co j - 1)
                      \biggr] \tau_1(\di j).
\end{align*}

Подставим $g_1^H(i, \tau_1)$ и $g_1^L(i,\tau_1)$ в правую часть~\eqref{ch2:eq:low-bound-dual:general} и получившийся результат обозначим как
\begin{equation}\label{eq:W-low-bound:parameterized}
\begin{multlined}
  \Gf[i][h] =
  W_{2,n}\left( 
    x - \int_0^1 \left[ \Ind_{h(u) < i} - \Ind_{h(u) > i} \right] \di u
  \right) \; - \\
  - \int_0^1 \left[ 
    \Ind_{h(u) < i} (-\Co i - \DCo h(u)) + 
    \Ind_{h(u) > i} (\DCo i + \Co h(u)) 
  \right] \di u.
\end{multlined}
\end{equation}

\begin{lemma}\label{ch2:lem:W-low-bound:parameterized}
  Для любого $x \in \mathbb{R}$ выполнено неравенство
  \begin{equation*}
    W_{2,n+1}(x) \geqslant \sup_h \inf_{i} \Gf[i][h].
  \end{equation*}
\end{lemma}

Будем искать стратегию второго игрока, выравнивающую его выигрыш при $i \in [h(0), h(1)]$.
Пусть $i = h(\alpha)$ для некоторого $\alpha \in [0, 1]$, и $h(\cdot)$ возрастает в некоторой окрестности точки $\alpha$.
Тогда для выравнивающей функции $h$ выражение
\begin{equation}\label{ch2:eq:G(ha)}
\begin{multlined}
  \Gf[h(\alpha)][h] =
  W_{2,n}(x + 1 - 2\alpha) - \\
  - \int_\alpha^1 \biggl( \DCo h(\alpha) + \Co h(u) \biggr) \di u +
  \int_0^\alpha \biggl( \Co h(\alpha) + \DCo h(u) \biggr) \di u.
\end{multlined}
\end{equation}
не зависит от $\alpha$. Следовательно
\begin{equation*}
  \frac{\partial G_{n+1}}{\partial \alpha} =
  2h(\alpha) + (\alpha - \DCo)h'(\alpha) - 2 W_{2,n}'(x - 2\alpha + 1) = 0.
\end{equation*}
Отсюда
\begin{equation}\label{ch2:eq:h(u)}
  h(u) = 2(u - \DCo)^{-2} \int_\DCo^u (s - \DCo) W_{2,n}'(x - 2s + 1) \di s\footnotemark.
  \footnotetext{При $u = \DCo$ доопределим $h(\DCo)$ по непрерывности как $W_{2,n}'(x - 2\DCo + 1)$.}
\end{equation}
Если подставить $h(u)$ в~\eqref{ch2:eq:G(ha)} то получившееся выражение, которое мы обозначим $\Psi(h)$, не зависит от $\alpha$.
Доказательство следующей леммы аналогично доказательству леммы~\ref{ch2:lem:Phi}.

\begin{lemma}
  Для значения $\Psi(h)$ справедливо равенство
  \begin{equation}
    \Psi(h) = \int_0^1 W_{2,n}(x - 2s + 1) \di s.
  \end{equation}
\end{lemma}

Отметим, что несмотря на зависимость $h(u)$ от $\beta$, выражение для функции $\Psi(h)$ от него не зависит и по форме совпадает с аналогичным выражением в~\cite{demeyer02}.
Таким образом, остается показать, что функция $h(\cdot)$ действительно является параметризацией некоторой стратегии $\tau_1$ второго игрока, и нижняя оценка его выигрыша равна $\Psi(h)$.
Доказательство следующей леммы во многом повторяет доказательства лемм~\ref{ch2:lem:f-Q-is-strategy} и~\ref{ch2:lem:f=Q}.
\begin{lemma}\label{ch2:lem:h(u)-props}
  Функция $h(u)$, определенная в~\eqref{ch2:eq:h(u)}, обладает следующими свойствами:
  \begin{itemize}
  \item 
  $u \in [0, 1] \implies h(u) \in [0, 1];$
  \item 
  $\forall u_1, u_2 \in [0, 1]: u_1 < u_2 \implies h(u_1) \leq h(u_2);$
  \item 
  $h(u_1) = h(u_2) \implies h(u_1) = W_{2,n}'(x - 2u_1 + 1) = W_{2,n}'(x - 2u_2 + 1)$.
  \end{itemize}
  В частности, функция $h(\cdot)$ может служить параметризацией некоторой стратегии $\tau_1$ второго игрока.
\end{lemma}

\begin{theorem}\label{ch2:thm:W-bound}
  Для гарантированного выигрыша второго игрока в игре $G_{n+1}^*(x)$ справедлива оценка
  \begin{equation*}
    W_{2,n+1}(x) \geqslant \int_0^1 W_{2,n}(x - 2s + 1) \di s.
  \end{equation*}
\end{theorem}
\begin{proof}
  Из леммы~\ref{ch2:lem:W-low-bound:parameterized} следует, что нам достаточно показать, что при любом $i \in [0, 1]$ выполнено $\Gf[i][h] \geqslant \Psi(h)$.
  Рассмотрим несколько случаев.

  При $i < h(0)$ из~\eqref{eq:W-low-bound:parameterized} и~\eqref{ch2:eq:G(ha)} получаем
  \begin{multline*}
    \Gf[i][h] =
    W_{2,n}(x + 1) - \int_0^1 \left( \DCo i + \Co h(u) \right) \di u \geqslant \\
    \geqslant W_{2,n}(x + 1) - \int_0^1 \left( \DCo h(0) + \Co h(1) \right) \di
    u = \Gf[h(0)][h] = \Psi(h).
  \end{multline*}

  Аналогично можно показать, что при $i > h(1)$ выполняется неравенство $\Gf[i][h] \geqslant \Psi(h)$.

  Пусть теперь $i = h(\alpha), \; \alpha \in [0, 1]$. Введем обозначения
  \[
    \alpha^- = \inf \left\{ x \;|\; h(x) = h(\alpha) \right\}, \quad \alpha^+ =
    \sup \left\{ x \;|\; h(x) = h(\alpha) \right\}.
  \]
  
  Из~\eqref{eq:W-low-bound:parameterized} находим
  \begin{multline}\label{ch2:eq:g+-}
    \Gf[i][h] = W_{2,n}(x + 1 - \alpha^- - \alpha^+) \enskip - \\
    - \int_0^{\alpha^-} \left(-\Co i - \DCo h(u)\right) \di u -
    \int_{\alpha^+}^1 \left(\DCo i + \Co h(u)\right) \di u.
  \end{multline}
  Поскольку $W_{2,n}(\cdot)$ "--- дифференцируемая вогнутая функция, верно неравенство
  \begin{multline*}
    W_{2,n}(x + 1 - 2\alpha) \leqslant W_{2,n}(x + 1 - \alpha^- - \alpha^+) \enskip +\\
    + W_{2,n}'(x + 1 - \alpha^- - \alpha^+) \left( [ \alpha^+ - \alpha ] + [
      \alpha^- - \alpha ] \right).
  \end{multline*}
  Из леммы~\ref{ch2:lem:h(u)-props} при $u_1 = (\alpha^- + \alpha^+)/2,\: u_2 = \alpha$ следует, что
  \[
    W_{2,n}'(x + 1 - \alpha^- - \alpha^+) = W_{2,n}'(x + 1 - 2\alpha) =
    h(\alpha).
  \]
  Так как $h(u)$ постоянна на $[\alpha^-, \alpha^+]$ и $h(\alpha) = i$ имеем
  \begin{multline*}
    W_{2,n}(x + 1 - \alpha^- - \alpha^+) \geqslant W_{2,n}(x + 1 - 2\alpha) - \\
    - \int_\alpha^{\alpha^+} \left( \DCo i + \Co h(u) \right) \di u +
    \int_{\alpha^-}^\alpha \left( \Co i + \DCo h(u) \right) \di u.
  \end{multline*}
  Используя оценку на $W_{2,n}(x + 1 - \alpha^- - \alpha^+)$ в \eqref{ch2:eq:g+-}, получаем
  \begin{multline*}
    \Gf[i][h] \geqslant W_{2,n}(x + 1 - 2\alpha)
    - \int_\alpha^1 \biggl( \DCo h(\alpha) + \Co h(u) \biggr) \di u \; + \\
    + \int_0^\alpha \biggl( \Co h(\alpha) + \DCo h(u) \biggr) \di u =
    \Gf[h(\alpha)][h] = \Psi(h).
  \end{multline*}
  Таким образом, требуемое неравенство справедливо при любом $i \in [0, 1]$.
\end{proof}

\section{Значение игры $\mathbf{G_n\left(p\right)}$}
\label{ch2:sec:game-value}

Поскольку выражения для нижних оценок в теоремах~\ref{ch2:thm:V-bound} и~\ref{ch2:thm:W-bound} совпадают с аналогичными выражениями в \cite{demeyer02}, справедливы все двойственные соотношения между $V_{1,n}(p)$ и $W_{2,n}(x)$, а также утверждения относительно оптимальности стратегий.
Приведем соответствующие теоремы.

\begin{theorem}
  Для всех $x \in \mathbb{R}$ выполнено
  \begin{equation}\label{ch2:eq:duality-relationships}
    V_{1,n}^*(x) = W_{1,n}(x) = V_{2,n}^*(x) = W_{2,n}(x).
  \end{equation}
  Таким образом, игры $G_n(p)$ и $G_n^*(x)$ имеют значения $V_n(p)$ и $W_n(x)$ соответственно.
  Кроме того,
  \begin{equation}\label{ch2:eq:W-recursive}
    W_{n+1}(x) = \int_0^1 W_n(x - 2u + 1) \di u.
  \end{equation}
\end{theorem}

\begin{theorem}\label{ch2:thm:optimal-strategies}
  Стратегии $\sigma$ и $\tau$ являются оптимальными в игре $G_n(p)$ тогда и только тогда, когда $(p, \sigma),$ $\tau$ являются оптимальными при $x = V_n'(p)$ в игре $G_n^*(x)$.
\end{theorem}

\begin{corollary}
  \label{ch2:cor:value-indep-beta}
  Значения игр $G^\Co_n(p)$ и $G^{*\Co}_n(x)$ не зависят от коэффициента $\Co$.
\end{corollary}

Нужно отметить, что в силу следствия~\ref{ch2:cor:value-indep-beta} содержание утверждений об асимптотике значения игры и динамике апостериорных вероятностей справедливо и для данной модели без каких-либо изменений.
Приведем соответствующие утверждения.

Обозначим через $f_n$ функция распределения суммы случайных величин $S_n = \sum_{k=1}^n U_k / \sqrt{n}$, где случайные величины $U_k$ распределены равномерно на отрезке $[-1, 1]$.
Также введем обозначение $\psi_n(p) = V_n(p)/\sqrt{n}$.

\begin{proposition}[{{\cite[Следствие 3]{demeyer02}}}]
Пусть величина $x_p$ определяется из условия 
$
  p~=~\int_{x_p}^\infty f_n(s) \di s.
$
Тогда справедливы равенства
\begin{equation*}
  \psi_n(p) = \int_{x_p}^\infty s f_n(s) \di s, \enskip
  \psi'_n(p) = x_p.
\end{equation*}
\end{proposition}

Введем обозначение $\psi^*(x) = \E \min(0, x + Z/\sqrt{3})$, где $Z$ "--- случайная величина, имеющая стандартное нормальное распределение.

\begin{proposition}[{{\cite[Следствие 4]{demeyer02}}}]
Последовательности функций $\psi^*_n$ и $\psi^{*\prime}_n$ сходятся равномерно к $\psi^*$ и $\psi^{*\prime}$ соответственно.
Более того, $\psi_n(p)$ равномерно сходится к функции $\psi(p)$, которая определяется следующим образом:
\begin{equation*}
  \psi(p) = e^{-z_p^2/2}/\sqrt{6\pi},
\end{equation*}
где $z_p$ удовлетворяет равенству $p = \int_{z_p}^\infty e^{-s^2/2}/\sqrt{2\pi}$.
\end{proposition}

Обозначим $p_m$ апостериорную вероятность состояния $H$ после $m$-го шага игры.
Кроме того, обозначим $p^n$ непрерывный случайный процесс, определенный для $t \in [0, 1]$ как $p^n_t = p_{[nt]}$.

\begin{proposition}[{{\cite[Теорема 12]{demeyer02}}}]
  Случайный процесс $p^n$ при $n \rightarrow \infty$ сходится в смысле конечномерных распределений к процессу $\pi$, который определяется следующим образом:
  \begin{align*}
    \pi_t &= \psi^{*\prime} \left(
      \frac{x_p - B_t/\sqrt{3}}{\sqrt{1-t}}
    \right) =
    F\left( \frac{z_p - B_t}{\sqrt{1-t}} \right),\\
    F(x) &= \int_{-\infty}^x e^{-z^2/2}/\sqrt{2\pi} \di s,
  \end{align*}
  где $B$ "--- стандартный винеровский процесс, а $z_p$ удовлетворяет $F(z_p) = p$.
\end{proposition}

\begin{proposition}[{{\cite[Лемма 9]{demeyer02}}}]
  Существует константа $C$ такая, что для всех $m, n$ при $m < n$ выполняется неравенство
  \begin{equation*}
    | i_m - p_m | \leq C / \sqrt{n - m},
  \end{equation*}
  где $i_m$ "--- ставка игрока~1 на $m$-м шаге игры.
\end{proposition}

Обоснуем сделанные ранее предположения о непрерывной дифференцируемости функций $V_{1,n}(\cdot)$, $V_{1,n}^*(\cdot)$ и $W_{2,n}(\cdot)$.

\begin{proposition}
  При любом $n \geqslant 1$ функция $W_n(\cdot)$ является непрерывно дифференцируемой на $\mathbb{R}$.
\end{proposition}
Это сразу следует из формулы~\eqref{ch2:eq:W-recursive} и того, что $W_0(x) = \min(x, 0)$.
Рассмотрим подробнее, как ведет себя $W_n'(x)$.

\begin{lemma}\label{ch2:lem:W'-props}
  Для любого $n \geqslant 1$ выполняется\textnormal{:}
  \begin{enumerate}
  \item $W_n'(x) = 1$ при $x \in (-\infty, -n];$
  \item $W_n'(x) = 0$ при $x \in [n, \infty);$
  \item $W_n'(x)$ убывает при $x \in [-n, n].$
  \end{enumerate}
\end{lemma}
\begin{proof}
  Из~\eqref{ch2:eq:W-recursive} следует, что
  \begin{equation}\label{ch2:eq:W'-recursive}
    W_{n+1}'(x) = \frac{1}{2} \left( W_n(x + 1) - W_n(x - 1) \right).
  \end{equation}
  Отсюда
  \begin{equation}\label{ch2:eq:W1'}
    W_1'(x) =
    \begin{cases}
      1, &x < -1, \\
      (1-x)/2,  &-1 \leqslant x \leqslant 1, \\
      0, &x > 1.
    \end{cases}
  \end{equation}
  Таким образом, утверждение леммы верно при $n = 1$.
  Пусть также утверждение леммы верно при $n \leqslant N$, докажем его справедливость при $n = N + 1$.

  Из~\eqref{ch2:eq:W'-recursive} следует, что для некоторого $\Theta \in (-1,1)$ верно равенство
  \[
    W_{N+1}'(x) = W_{N}'(x + \Theta).
  \]
  Отсюда получаем справедливость первых двух утверждений леммы.
  Далее, из~\eqref{ch2:eq:W'-recursive} получаем 
  \[
    W_{N+1}''(x) = 1/2 \left( W_{N}'(x + 1) - W_{N}'(x - 1) \right).
  \]
  Так как $W_N'(x)$ убывает на $[-N, N]$, то $W_N'(x + 1)$ убывает на $[-N-1, N - 1]$, $W_N'(x - 1)$ убывает на $[-N + 1, N+1]$, а значит $W_{N+1}''(x)$ отрицательна при $x \in [-N-1, N+1]$.
  Отсюда получаем третье утверждение леммы.
\end{proof}

\begin{proposition}
  При любом $n \geqslant 1$ функция $V_n(\cdot)$ является непрерывно дифференцируемой на $[0, 1]$.
\end{proposition}
\begin{proof}
  Из~\eqref{ch2:eq:subdiff-props} следует, что
  \begin{equation*}
    x_1^* \neq x_2^* \in \partial V_n(p) \iff p = W_n'(x_1^*) = W_n'(x_2^*).
  \end{equation*}
  Однако по лемме~\ref{ch2:lem:W'-props} функция $W_n'(\cdot)$ убывает от $1$ до $0$.
  Следовательно $\partial V_n(\cdot)$ содержит только одно значение в каждой точке отрезка $[0, 1]$, что эквивалентно дифференцируемости $V_n(\cdot)$.
  Из того, что $V_n(\cdot)$ к тому же непрерывна, ограниченна и вогнута, получаем непрерывность ее производной на $[0, 1]$.
\end{proof}

\noindent
\textbf{Алгоритм} (поиска оптимальных стратегий в игре $G_n(p)$).
В силу рекурсивной структуры игры $G_n(p)$ достаточно описать способ получения оптимальных действий игроков на первом шаге игры при заданном значении $p$ вероятности состояния $H$.
\begin{enumerate}
\item
  Находим $\lambda$ как решение уравнения 
  $
    p = W'_n(\lambda).
  $
  Производная $W'_n(\cdot)$ является кусочно-полиномиальной функцией $n$-го порядка.
  Следовательно, ее корни могут быть найдены численно с любой заданной точностью.
\item
  Согласно~\eqref{ch2:eq:Q(u)} и~\eqref{ch2:eq:duality-relationships} находим функцию 
  \[
    Q(u) = W'_{n-1}(\lambda + 1 - 2u).
  \]
  В силу сказанного выше функция $Q(u)$ является кусочно-полиномиальной порядка $n-1$.
\item
  Выбираем $u_1$ как реализацию случайной величины $U_1$, распределенной на $[0, 1]$ с плотностью вероятности $Q(u)/p$ в состоянии $H$ и $\left(1 - Q(u)\right)/(1-p)$ в состоянии $L$.
\item
  Согласно~\eqref{ch2:eq:f} находим 
  \[
    i = f(u_1) = (u_1 - \DCo)^{-2} \int_\DCo^{u_1} 2 (x - \DCo) Q(x) \di x.
  \]
  Так как для расчета оптимальной ставки $i$ необходимо знать значение $f(u)$ лишь в одной точке $u$, оно может быть эффективно найдено численно.
\item
  Находим $u_2$ как реализацию случайной величины $U_2$, распределенной равномерно на $[0, 1]$
\item
  Из~\eqref{ch2:eq:h(u)} и теоремы~\ref{ch2:thm:optimal-strategies} следует, что выражения для $h$ и $f$ совпадают.
  Таким образом, оптимальная ставка второго игрока $j = h(u_2) = f(u_2)$.
\item
  Если $n = 1$, игра заканчивается после объявления ставок. В противном случае игроки переходят к игре $G_{n-1}(p^1)$, где $p^1 = Q(u_1)$.
\end{enumerate}

\section{Примеры}
В данном разделе даны примеры использования описанного выше алгоритма при построении аналитического решения для игр $G_1(p)$ и $G_2(p)$.

\begin{example}
  Найдем оптимальные $f$ и $Q$ в игре $G_1(p)$.
  Из~\eqref{ch2:eq:W1'} получаем, что $\lambda = 1 - 2p$ является решением уравнения $p = W'_1(\lambda)$.
  Отсюда
  \begin{equation*}
    Q(u) = W'_0(\lambda + 1 - 2u) = \begin{cases}
      0, &\; u < 1 - p,\\
      1, &\; u > 1 - p.
    \end{cases}
  \end{equation*}
  Пусть $p < \Co$.
  Тогда
  \begin{align*}
    f(u) 
    &=
      (u - \DCo)^{-2} \int_{1-p}^u 2 (x - \DCo) Q(x) \di x = \\
    &=
      \begin{cases}
        0, &\; u \leqslant 1 - p,\\
        1 - \frac{(1 - p - \DCo)^2}{(u-\DCo)^2}, &\; u > 1 - p.
      \end{cases}
  \end{align*}
  Случай $\DCo \geqslant 1 - p$ разбирается аналогично.
\end{example}

\begin{example}
  Найдем оптимальные $f$ и $Q$ в игре $G_2(p)$.
  Из~\eqref{ch2:eq:W1'} получаем
  \begin{equation*}
    W_1(x) = \begin{cases}
      x, &\; x \leqslant 1,\\
      1/4 (-1 + 2x - x^2), &\; -1 < x < 1,\\
      0, &\; x \geqslant 1.
    \end{cases}
  \end{equation*}
  Отсюда по формуле~\eqref{ch2:eq:W'-recursive} находим
  \begin{align*}
    W'_2(x) 
    &= \frac{1}{2} \left( W_1(x+1) - W_1(x-1) \right) =\\
    &= \begin{cases}
      1, &\; x < -2,\\
      (4 - 4x - x^2)/8, &\; -2 \leqslant x < 0,\\
      (x - 2)^2/8, &\; 0 \leqslant x < 2,\\
      0, &\; x \geqslant 2.
    \end{cases}
  \end{align*}

  \begin{figure}[b]
    \centering \input{figures/ch2-w2}
    \caption{График функции $W_2'(x)$}
    \label{ch2:fig:W2}
  \end{figure}

  Пусть $1/2 \leqslant p \leqslant 1$.
  Тогда искомое $\lambda$ находится как решение следующего уравнения (\seename рис.~\ref{ch2:fig:W2}):
  \[
  (4 - 4\lambda - \lambda^2)/8 = p.
  \]
  Отсюда $\lambda = -2 + 2\sqrt{2 - 2p}$, а следовательно имеет место равенство
  \begin{align*}
    Q(u) 
    &= W'_1(\lambda + 1 - 2u) =\\
    &= \begin{cases}
      1 - \sqrt{2 - 2p} + u, &\; u < \sqrt{2 - 2p},\\
      1, &\; u \geqslant \sqrt{2 - 2p}.
    \end{cases}
  \end{align*}
  Пусть $\DCo < \sqrt{2 - 2p}$. Тогда для $f$ имеет место следующая формула:
  \begin{equation*}
    f(u) = \begin{cases}
      1 - \sqrt{2 - 2p} + (2u + \DCo)/3, &\; u \leqslant \sqrt{2 - 2p},\\
      1 - (\sqrt{2 - 2p} - \DCo)^3/\left(3(u - \DCo)^2\right), &\; u > \sqrt{2 - 2p}.
    \end{cases}
  \end{equation*}
  Оставшиеся случаи разбираются аналогично.
\end{example}
}

%%% Local Variables:
%%% coding: cp1251
%%% TeX-master: "../dissertation"
%%% End:
